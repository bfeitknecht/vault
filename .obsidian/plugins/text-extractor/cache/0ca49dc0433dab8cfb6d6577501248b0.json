{"path":"sem4/FMFP/UE/slides/CN-u07-slides.pdf","text":"Computer Networks - Exercise 7 BGP ETH Zürich Slides by Alice La Porta and Paul Ellsiepen Based on the work of Nicolas Stucki, Binică Nicolae and Diego de los Santos April 2025 - BGP - Policies - Protocol - Problems - Kahoot! - Exercise #7 2 Table of contents BGP 4 BGP - The “Two-Napkin” Protocol Open Update Notiﬁc. © Cisco - Intra-Domain Routing - Routing within an AS - Interior Gateway Protocols (IGPs) - OSPF - IS-IS - Inter-Domain Routing - Routing between multiple ASes - Exterior Gateway Protocols (EGPs) - BGP 5 Types of routing Image source: vmware docs General Idea: Announce to the other ASes that an IP preﬁx resides in your AS Things to take care of: - Who should we announce it to? - What path should we select? - How to deal with received announcements? 6 BGP Scalability: Huge number of networks and preﬁxes Privacy: ASes don’t want to divulge internal topologies or business relationships Policy enforcement: ASes need to control where to send and receive trafﬁc 7 Key Challenges BGP Policies Intuition: ASes connect only if they have a business relationship Two main business relationships: - Customer/provider - Peer/peer 9 BGP Policies Customers pay providers to get internet connectivity Example: Swisscom is a customer of Deutsche Telekom 95th percentile rule: - Record the number of bytes sent/received every 5 minutes - At the end of the month, sort all values - Remove the top 5% values - Use highest remaining value for the bill 10 Customer/Provider Relationship Peers don’t pay each other for connectivity (common interest) Notes: - Providers transit trafﬁc for their customers - Peers do not transit trafﬁc between each other (no chain of peers) - Customers do not transit trafﬁc between their providers 11 Peer/Peer Relationship Controls outbound trafﬁc Prefer routes coming from: - Customers over - Peers over - Providers Intuition: Always prefer the option that brings money 12 Path Selection Deﬁnes which inbound trafﬁc is allowed Routes coming from: - Customers are propagated to everyone else - Peers and Providers are only propagated to customers 13 Path Export Send to Customer Peer Provider Customer ✅ ✅ ✅ From Peer ✅ ❌ ❌ Provider ✅ ❌ ❌ Gao-Rexford Rules 14 Tier-1 ASes must be connected through a full mesh of peer links BGP Policies BGP Protocol - External BGP (eBGP) sessions - Connect border routers in different ASes - Used to learn routes to external destinations - Internal BGP (iBGP) sessions - Connect routers in the same AS - Used to disseminate externally-learned routes (via eBGP) internally 16 BGP Protocol eBGP sessions iBGP sessions Four basic messages: - OPEN = establish TCP-based BGP sessions - NOTIFICATION = report unusual conditions - KEEPALIVE = inform neighbor that the connection is alive - UPDATE = inform neighbor of changes of best routes 17 BGP Protocol Message to inform neighbors about: - A new best route - Change of best route - Removal of best route They contain: - IP Preﬁx - Attributes (information about the route) - Local: Only seen in iBGP - Global: iBGP and eBGP 18 BGP UPDATE Global: - NEXT-HOP: Where to send trafﬁc next - It does not change within the AS - AS-PATH: Lists the AS that the route has traversed (in reverse order) - MED: Indicates a preference for a speciﬁc AS interface to a neighbor (lower is better) Local: - LOCAL-PREF: Indicates how preferred a route is (higher is better) 19 BGP UPDATE 20 BGP UPDATE - NEXT-HOP AS 10 AS 20 AS 30 AS 40 AS 50 Preﬁx 204.170.5.0/24 NEXT HOP 10.0.0.1 10.0.0.2 10.0.0.1 11.0.0.1 11.0.0.2 11.0.0.3 12.0.0.1 12.0.0.2 Preﬁx 204.170.5.0/24 NEXT HOP 10.0.0.1 Preﬁx 204.170.5.0/24 NEXT HOP 11.0.0.1 Preﬁx 204.170.5.0/24 NEXT HOP 11.0.0.1 Preﬁx 204.170.5.0/24 NEXT HOP 11.0.0.1 Preﬁx 204.170.5.0/24 NEXT HOP 12.0.0.1 Preﬁx 204.170.5.0/24 21 BGP UPDATE - AS-PATH AS 10 AS 20 AS 30 AS 40 AS 50 Preﬁx 204.170.5.0/24 AS-PATH 10 Preﬁx 204.170.5.0/24 AS-PATH 20 10 Preﬁx 204.170.5.0/24 AS-PATH 30 20 10 Preﬁx 204.170.5.0/24 AS-PATH 20 10 22 BGP UPDATE - MED AS 20 MED 10 MED 20 5 15 AS 50 indicates preference towards the left route AS 20 can take this into consideration but may also ignore it (e.g. if LOCAL-PREF is higher for the right route) AS 50 23 BGP UPDATE - LOCAL-PREF AS 30 AS 20 AS 50 LOCAL-PREF 100 LOCAL-PREF 200 Set at the border according to path selection/export rules Has preference over internal route costs AS 10 BGP selects only one route out of the many possible ones for forwarding This is how routes are ranked: 1. Higher LOCAL-PREF 2. Shorter AS-PATH length 3. Lower MED 4. Learned via eBGP instead of iBGP 5. Lower IGP metric to the next-hop 6. Smaller egress IP address 24 Single Path Protocol Route quickly out of the AS: Hot potato routing B(ad)GP - Reachability - Security - Nonexistent in BGP - Convergence - No guarantee for arbitrary rules - Guaranteed for Gao-Rexford rules - Performance - Mostly based on economics, not on performance - Anomalies - Many “knobs” and interpretations - Manually conﬁgured → Easy to make mistakes 26 BGP Problems AS 10 Policy routing does not guarantee reachability even if the graph is connected, e.g. 27 BGP Problems - Reachability AS 20 AS 50 KahootExercise #7 Question 1.1: Private IP Address 30 RFC 1918 speciﬁes 10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16 as private addresses suitable for unrestricted private internal use. 1) Could 172.28.2.0/24 be used as the address space for an internal network? Yes. 172.28.2.x falls under the /12 block. The range (RFC 1918) is 172.16.0.0 - 172.31.255.255 Question 1.2: Private IP Address 31 RFC 1918 speciﬁes 10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16 as private addresses suitable for unrestricted private internal use. 1) Could 10.255.255.0/24 be used as the address space for an internal network? Yes. Again, this falls under 10.0.0.0/8 Question 1.3: Private IP Address 32 Assume a technically illiterate user conﬁgures 8.8.8.0/24 as the internal address space on their home router. They use a NAT, and the public address is 19.33.93.140. A user with IP 8.8.8.2 attempts to establish connection with a system on the internet, 8.8.8.8 1) Can the two systems communicate? Address space is from 8.8.8.0 to 8.8.8.225. Any user on the network would think that 8.8.8.8 is on the local network, and will thus not be able to communicate with google. Question 2: The Border Gateway Protocol 33 AS 1 starts by announcing 13.13.0.0/16 at time 0 into the network. preﬁx : 13.13.0.0/16 Path: {AS1} Send to AS2, AS5, AS6 Question 2.1: The Border Gateway Protocol 34 State the path vector that AS5 sends out at time 1 and to which of its neighbors it is sent. preﬁx : 13.13.0.0/16 Path: {AS1} Send to AS2, AS5, AS6 preﬁx : 13.13.0.0/16 Path: {AS5, AS1} Send to AS4, AS6, AS7 Question 2.2: The Border Gateway Protocol 35 State the path vectors that AS7 sends out at time 2 and to which of its neighbors it is send Path vector 1: preﬁx : 13.13.0.0/16 Path: {AS7, AS5, AS1} Send to AS6, AS8 Path vector 2: preﬁx : 13.13.0.0/16 Path: {AS7, AS6, AS1} Send to AS5 Question 2.3: The Border Gateway Protocol 36 A valid AS-level path is one that is allowed by economic policies. 1) List all possible, valid, AS-level paths from AS8 to the preﬁx 13.13.0.0/16: - {AS8, AS4, AS5, AS1} - {AS8, AS7, AS5, AS1} Question 2.3: The Border Gateway Protocol 37 A valid AS-level path is one that is allowed by economic policies. 1) Argue why {AS8, AS7, AS6, AS1} is a valid (or invalid) AS-level path from AS 8 to the preﬁx 13.13.0.0/16? - no announcements from peer to peer (no revenue gained). Question 2.4: The Border Gateway Protocol 38 AS chooses path that gives them the best revenue. Possible Paths: - {AS8, AS4, AS5, AS1} - {AS8, AS7, AS5, AS1} Which path will AS8 use to route to preﬁx 13.13.0.0/16? - Choose path through AS4, since it would make money by sending trafﬁc to the customer. - There would be no money made by sending to peer! Question 3: BGP Convergence 39 Each router has a Route Selection Policy and an Export Policy Question 3: BGP Convergence 40 Route selection policy: - Each router has a box with dotted lines which shows the preferred routes to destination D. If there are two, they prefer the upper route. Example: AS 3 prefers route {321D} over route {34D} to reach AS D, and uses route {34D} only if route {321D} is not available. - If there is no preferred route available, they leave their table empty. Export policy: - Announce the route that has been selected by the route selection policy to all neighboring ASes. For example, AS 1 announces the route {1D} to AS 2. Question 3: BGP Convergence 41 Assume the all BGP routing tables are empty and AS D announces itself 1) What routes do ASes 1, 2, 3, 4 use to reach AS D? {1D}, None, None, {4D} Question 3.2: BGP Convergence 42 All ASes make BGP announcements based on the export policy. 1) What routes do ASes 1, 2, 3, 4 use to reach AS D? {1D}, {21D}, {34D}, {4D} Question 3.3: BGP Convergence 43 Again! 1) What routes do ASes 1, 2, 3, 4 use to reach AS D? {1D}, {234D}, {321D}, {4D} Question 3.4: BGP Convergence 44 Again??! 1) What routes do ASes 1, 2, 3, 4 use to reach AS D? {1D}, {21D}, {34D}, {4D} Question 3.5: BGP Convergence 45 Again *.* 1) What routes do ASes 1, 2, 3, 4 use to reach AS D? What is the pattern here? {1D}, {234D}, {321D}, {4D}, routes for 2 and 3 keep oscillating indeﬁnitely! Question 4: Poison reverse 46 Poisoned Reverse is a method to prevent the \"count to inﬁnity\" problem encountered when a link fails by sending back a route cost of ∞ to the node that the route was learned from. Fill in the table of distance vectors. Links Time 0 Time 1 Time 2 Time 3 Time 4 A-B 1, B 1, B ? ? ? A-C 1, C 1, C ? ? ? B-C 1, C 1, C ? ? ? B-D 2, A 2, A ? ? ? C-D 2, A 2, A ? ? ? A-D 1, D inf, - ? ? ? Question 4: Poison reverse 47 Links Time 0 Time 1 Time 2 Time 3 Time 4 A-B 1, B 1, B 1, B ? ? A-C 1, C 1, C 1, C ? ? B-C 1, C 1, C 1, C ? ? B-D 2, A 2, A 3, C ? ? C-D 2, A 2, A 3, B ? ? A-D 1, D inf, - inf, - ? ? Poisoned Reverse is a method to prevent the \"count to inﬁnity\" problem encountered when a link fails by sending back a route cost of ∞ to the node that the route was learned from. Fill in the table of distance vectors. Question 4: Poison reverse 48 Links Time 0 Time 1 Time 2 Time 3 Time 4 A-B 1, B 1, B 1, B 1, B ? A-C 1, C 1, C 1, C 1, C ? B-C 1, C 1, C 1, C 1, C ? B-D 2, A 2, A 3, C inf, - ? C-D 2, A 2, A 3, B inf, - ? A-D 1, D inf, - inf, - 4, B/C ? Poisoned Reverse is a method to prevent the \"count to inﬁnity\" problem encountered when a link fails by sending back a route cost of ∞ to the node that the route was learned from. Fill in the table of distance vectors. Question 4: Poison reverse 49 Links Time 0 Time 1 Time 2 Time 3 Time 4 A-B 1, B 1, B 1, B 1, B 1, B A-C 1, C 1, C 1, C 1, C 1, C B-C 1, C 1, C 1, C 1, C 1, C B-D 2, A 2, A 3, C inf, - inf/5, A C-D 2, A 2, A 3, B inf, - 5, A/inf A-D 1, D inf, - inf, - 4, B/C inf, - Poisoned Reverse is a method to prevent the \"count to inﬁnity\" problem encountered when a link fails by sending back a route cost of ∞ to the node that the route was learned from. Fill in the table of distance vectors. Question 4: Poison reverse 50 Links Time 4 Time 5 Time 6 Time 7 Time 8 A-B 1, B 1, B 1, B 1, B 1, B A-C 1, C 1, C 1, C 1, C 1, C B-C 1, C 1, C 1, C 1, C 1, C B-D inf, - inf, - 6, C inf, - inf, - C-D inf, - 5, A inf, - inf, - 8, A A-D 4, B inf, - inf, - 7, B inf, - Poisoned Reverse is a method to prevent the \"count to inﬁnity\" problem encountered when a link fails by sending back a route cost of ∞ to the node that the route was learned from. Fill in the table of distance vectors.","libVersion":"0.5.0","langs":""}