{"path":"sem2/DDCA/VRL/slides/DDCA-L09b-timing.pdf","text":"C a r ne gi e M e l l on 1 D i g i t a l D e s i g n a nd C o m put e r A r c hi t e c t ur e M o ha m m a d S a dr o s a da t i F r a nk K . G ür k a y na k A d a p t e d f r o m D i g i t a l D e s i g n a n d C o m p u t e r A r c h i t e c t u r e , D a v i d M o n e y H a r r i s & S a r a h L . H a r r i s © 2 0 0 7 E l s e v i e r http:// safari.ethz.ch / ddca Se q u e n t i al Ci rc u i t s : T i mi n g C a r ne gi e M e l l on 2 Wh a t w ill w e lea r n ? ¢ T i m i n g o f S e q u e n t i a l L o gi c § S e t up t i m e § H o l d t i m e ¢ Cl o c k f r eq u en c y ¢ M e t a s t a b i l i t y an d p r e ve n t i o n C a r ne gi e M e l l on 3 Ti m i ng ¢ Fl i p - f l o p s a m p l e s D a t c l o c k e d ge ¢ D m u s t b e s t a b l e wh e n i t i s s a m p l e d ¢ S i m i l a r t o a p h o t o gr a p h , D m u s t b e s t a b l e a r o u n d t h e c l o c k e d ge ¢ I f D i s c h a n gi n g w h e n i t i s s a m p l e d , me t as t abi l i t y ca n occu r § R e c a l l t ha t a f l i p - f l o p c o pi e s t he i nput D t o t he o ut put Q o n t he r i s i ng e dg e o f t he c l o c k . T hi s pr o c e s s i s c a l l e d s a m pl i ng D o n t he c l o c k e dg e . I f D i s s t a bl e a t e i t he r 0 o r 1 w he n t he c l o c k r i s e s , t hi s be ha v i o r i s c l e a r l y de f i ne d. B ut w ha t ha ppe ns i f D i s c ha ng i ng a t t he s a m e t i m e t he c l o c k r i s e s ? C a r ne gi e M e l l on 4 In p u t T im in g C on str a in ts ¢ Set u p t ime : t se t u p = t i m e b e f o r e t h e c l o c k e d ge t h a t d a t a m u s t b e s t a b l e ( i . e . n o t c h a n gi n g) ¢ Hold t im e : t ho l d = t i m e a f t e r t h e c l o c k e d ge t h a t d a t a m u s t be s t a bl e ¢ Aper t u r e t i me : t a = t i m e a r o u n d c l o c k e d ge t h a t d a t a m u s t be s t a bl e ( t a = t se t u p + t ho l d ) CLK tsetup D thold ta C a r ne gi e M e l l on 5 Out put Ti m i ng C o ns t r a i nt s ¢ Pr op a g a t ion d e la y : t pc q = t i m e a f t e r c l o c k e d ge t h a t t h e o u t p u t Q i s gu a r a n t e e d t o b e s t a b l e ( i . e . , t o s t o p c h a n gi n g) ¢ Co n ta m i n a ti o n d e l a y : t ccq = t i m e a f t e r c l o c k e d ge t h a t Q m i gh t b e u n s t a b l e ( i . e . , s t a r t c h a n gi n g) CLK t ccq t pcq Q C a r ne gi e M e l l on 6 Dy n a m i c Di s ci p l i n e ¢ T h e i n p u t t o a s yn c h r o n o u s s e q u e n t i a l c i r c u i t m u s t b e s t a b l e d u r i n g t h e a p e r t u r e ( s e t u p a n d h o l d ) t i m e a r o u n d t h e c l o c k e d ge . ¢ S p e c i f i c a l l y, t h e i n p u t m u s t b e s t a b l e § at leas t t se t u p be f o r e t he c l o c k e dg e § a t l e a s t unt i l t ho l d af t e r t he c l o c k e dg e C a r ne gi e M e l l on 7 Dy n a m i c Di s ci p l i n e ¢ T h e d e l a y b e t w e e n r e gi s t e r s h a s a m i n i m u m a n d m a x i m u m d e l a y, d e p e n d e n t o n t h e d e l a ys o f t h e c i r c u i t e l e m e n t s CL CLKCLK R1 R2 Q1 D2 (a) CLK Q1 D2 (b) T c C a r ne gi e M e l l on 8 Se t u p T i me Co n s t rai n t ¢ T h e c l o c k p e r i o d o r c yc l e t i m e , T c , i s th e ti m e b etw een r i s i n g e d ge s o f a r e p e t i t i v e c l o c k s i gn a l . I t s r e c i p r o c a l , f c =1 / T c , i s t h e c l o c k f r e q u e n c y. ¢ A l l e l s e b e i n g t h e s a m e , i n c r e a s i n g t h e c l o c k f r e q u e n c y i n c r e a s e s t h e w o r k t h a t a d i gi t a l s ys t e m c a n a c c o m p l i s h pe r uni t t i me . ¢ F r e q u e n c y i s m e a s u r e d i n u n i t s o f H e r t z ( H z ) , o r c yc l e s p e r s e c o n d : § 1 m e g a he r t z ( M H z ) 1 0 6 Hz § 1 g i g a he r t z ( G H z ) 1 0 9 Hz . C a r ne gi e M e l l on 9 Se t u p T i me Co n s t rai n t ¢ Th e s e t u p t i m e c o n s t r a i n t d e p e n d s o n t h e m a x i m u m d e l a y f r o m re gi st e r R 1 t h ro u gh t h e c o m b i n a t i o n a l l o gi c. ¢ Th e i n p u t t o r e g i s t e r R 2 m u s t b e s t a b l e a t l e a s t t se t u p be f o r e t he cl o ck ed g e. CLK Q1 D2 T c t pcq t pd t setup CL CLKCLK Q1 D2 R1 R2 T c >= C a r ne gi e M e l l on 10 Se t u p T i me Co n s t rai n t ¢ Th e s e t u p t i m e c o n s t r a i n t d e p e n d s o n t h e m a x i m u m d e l a y f r o m re gi st e r R 1 t h ro u gh t h e c o m b i n a t i o n a l l o gi c. ¢ Th e i n p u t t o r e g i s t e r R 2 m u s t b e s t a b l e a t l e a s t t se t u p be f o r e t he cl o ck ed g e. CLK Q1 D2 T c t pcq t pd t setup CL CLKCLK Q1 D2 R1 R2 T c >= t pc q + t pd + t se t u p t pd <= C a r ne gi e M e l l on 11 Se t u p T i me Co n s t rai n t ¢ Th e s e t u p t i m e c o n s t r a i n t d e p e n d s o n t h e m a x i m u m d e l a y f r o m re gi st e r R 1 t h ro u gh t h e c o m b i n a t i o n a l l o gi c. ¢ Th e i n p u t t o r e g i s t e r R 2 m u s t b e s t a b l e a t l e a s t t se t u p be f o r e t he cl o ck ed g e. CLK Q1 D2 T c t pcq t pd t setup CL CLKCLK Q1 D2 R1 R2 T c >= t pc q + t pd + t se t u p t pd <= T c – ( t pc q + t se t u p ) C a r ne gi e M e l l on 12 Ho ld T im e C o ns t r a int ¢ Th e h o l d t i m e c o n s t r a i n t d e p e n d s o n t h e m i n i m u m d e l a y f r o m re gi st e r R 1 t h ro u gh t h e c o m b i n a t i o n a l l o gi c. ¢ Th e i n p u t t o r e g i s t e r R 2 m u s t b e s t a b l e f o r a t l e a s t t ho l d af t e r t h e c l oc k ed g e. CLK Q1 D2 tccq tcd thold CL CLKCLK Q1 D2 R1 R2 t ho l d < C a r ne gi e M e l l on 13 Ho ld T im e C o ns t r a int ¢ Th e h o l d t i m e c o n s t r a i n t d e p e n d s o n t h e m i n i m u m d e l a y f r o m re gi st e r R 1 t h ro u gh t h e c o m b i n a t i o n a l l o gi c. ¢ Th e i n p u t t o r e g i s t e r R 2 m u s t b e s t a b l e f o r a t l e a s t t ho l d af t e r t h e c l oc k ed g e. CLK Q1 D2 tccq tcd thold CL CLKCLK Q1 D2 R1 R2 t ho l d < t ccq + t cd t cd > C a r ne gi e M e l l on 14 Ho ld T im e C o ns t r a int ¢ Th e h o l d t i m e c o n s t r a i n t d e p e n d s o n t h e m i n i m u m d e l a y f r o m re gi st e r R 1 t h ro u gh t h e c o m b i n a t i o n a l l o gi c. ¢ Th e i n p u t t o r e g i s t e r R 2 m u s t b e s t a b l e f o r a t l e a s t t ho l d af t e r t h e c l oc k ed g e. CLK Q1 D2 tccq tcd thold CL CLKCLK Q1 D2 R1 R2 t ho l d < t ccq + t cd t cd > t ho l d - t ccq C a r ne gi e M e l l on 15 Ti m i ng Ana l y s i s CLK CLK A B C D X' Y' X Yper gate T i m i n g C h a r a c t e r i s t i c s t cc q = 3 0 ps t pc q = 5 0 ps t se t u p = 6 0 ps t ho l d = 7 0 ps t pd = 3 5 ps t cd = 2 5 ps t pd = t cd = Se t u p t i m e c o n s t r a i n t : T c ≥ f c = 1 / T c = Ho l d t i m e c o ns t r a i n t : t ccq + t cd > t ho l d ? C a r ne gi e M e l l on 16 Ti m i ng Ana l y s i s CLK CLK A B C D X' Y' X Y t pd = 3 x 3 5 ps = 1 0 5 ps t cd = 2 5 ps Se t u p t i m e c o n s t r a i n t : T c ≥ ( 5 0 + 1 0 5 + 6 0 ) ps = 2 1 5 ps f c = 1 / T c = 4 .6 5 G H z Ho l d t i m e c o ns t r a i n t : t ccq + t cd > t ho l d ? (3 0 + 2 5 ) ps > 7 0 ps ? No !per gate T i m i n g C h a r a c t e r i s t i c s t cc q = 3 0 ps t pc q = 5 0 ps t se t u p = 6 0 ps t ho l d = 7 0 ps t pd = 3 5 ps t cd = 2 5 ps C a r ne gi e M e l l on 17 Fi xi n g H o l d T i me Vi o l at i o n CLK CLK A B C D X' Y' X Y t pd = t cd = Se t u p t i m e c o n s t r a i n t : T c ≥ f c = Ho l d t i m e c o ns t r a i n t : t ccq + t cd > t ho l d ? Add buf f e r s t o t he s ho r t pa t hs :per gate T i m i n g C h a r a c t e r i s t i c s t cc q = 3 0 ps t pc q = 5 0 ps t se t u p = 6 0 ps t ho l d = 7 0 ps t pd = 3 5 ps t cd = 2 5 ps C a r ne gi e M e l l on 18 Fi xi n g H o l d T i me Vi o l at i o n CLK CLK A B C D X' Y' X Y t pd = 3 x 3 5 ps = 1 0 5 ps t cd = 2 x 2 5 ps = 5 0 ps Se t u p t i m e c o n s t r a i n t : T c ≥ ( 5 0 + 1 0 5 + 6 0 ) ps = 2 1 5 ps f c = 1 / T c = 4 .6 5 G H z Ho l d t i m e c o ns t r a i n t : t ccq + t cd > t ho l d ? (3 0 + 5 0 ) ps > 7 0 ps ? Ye s ! Add buf f e r s t o t he s ho r t pa t hs :per gate T i m i n g C h a r a c t e r i s t i c s t cc q = 3 0 ps t pc q = 5 0 ps t se t u p = 6 0 ps t ho l d = 7 0 ps t pd = 3 5 ps t cd = 2 5 ps C a r ne gi e M e l l on 19 Cl o c k Ske w ¢ Th e c l o c k d o e s n ’ t a r r i v e a t a l l r e g i s te r s a t th e s a m e ti m e ¢ Sk e w i s t h e d i f f e r e n c e b e t w e e n t w o c l o c k e d g e s ¢ Ex ami n e t h e w or s t c as e t o g u ar an t e e t h at t h e d y n ami c d i s c i p l i n e i s no t v i o l a t e d f o r a ny r e g i s t e r – man y r e g i s t e r s i n a s y s t e m! t skew CLK1 CLK2 CL CLK2CLK1 R1 R2 Q1 D2 CLKdelay CLK C a r ne gi e M e l l on 20 Se t u p T i me Co n s t rai n t w i t h Cl o c k Ske w ¢ In t h e w or s t ca s e , t h e C LK 2 is ea r l i er th a n CL K 1 CLK1 Q1 D2 T c t pcq t pd t setup t skew CL CLK2CLK1 R1 R2 Q1 D2 CLK2 T c >= C a r ne gi e M e l l on 21 Se t u p T i me Co n s t rai n t w i t h Cl o c k Ske w ¢ In t h e w or s t ca s e , t h e C LK 2 is ea r l i er th a n CL K 1 CLK1 Q1 D2 T c t pcq t pd t setup t skew CL CLK2CLK1 R1 R2 Q1 D2 CLK2 T c >= t pc q + t pd + t se t u p + t sk e w t pd <= C a r ne gi e M e l l on 22 Se t u p T i me Co n s t rai n t w i t h Cl o c k Ske w ¢ In t h e w or s t ca s e , t h e C LK 2 is ea r l i er th a n CL K 1 CLK1 Q1 D2 T c t pcq t pd t setup t skew CL CLK2CLK1 R1 R2 Q1 D2 CLK2 T c >= t pc q + t pd + t se t u p + t sk e w t pd <= T c – ( t pc q + t se t u p + t sk e w ) C a r ne gi e M e l l on 23 Ho ld T im e C o ns t r a int w it h C lo c k S k ew ¢ In t h e w or s t ca s e , C LK 2 is la t e r th a n CL K 1 t ccq t cd t hold Q1 D2 t skew CL CLK2CLK1 R1 R2 Q1 D2 CLK2 CLK1 t ho l d + t sk e w =< C a r ne gi e M e l l on 24 Ho ld T im e C o ns t r a int w it h C lo c k S k ew ¢ In t h e w or s t ca s e , C LK 2 is la t e r th a n CL K 1 t ccq t cd t hold Q1 D2 t skew CL CLK2CLK1 R1 R2 Q1 D2 CLK2 CLK1 t ho l d + t sk e w =< t ccq + t cd t cd >= C a r ne gi e M e l l on 25 Ho ld T im e C o ns t r a int w it h C lo c k S k ew ¢ In t h e w or s t ca s e , C LK 2 is la t e r th a n CL K 1 t ccq t cd t hold Q1 D2 t skew CL CLK2CLK1 R1 R2 Q1 D2 CLK2 CLK1 t ho l d + t sk e w =< t ccq + t cd t cd >= t ho l d + t sk e w - t ccq C a r ne gi e M e l l on 26 Vi o l at i n g t h e D y n ami c D i s c i p l i n e ¢ A s yn c h r o n o u s ( f o r e x a m p l e , u s e r ) i n p u t s m i gh t v i o l a t e t h e d yn a m i c d i s c i p l i n e D Q CLKbutton CLK t setup t hold t aperture D Q D Q D Q ???Case ICase IICase III C a r ne gi e M e l l on 27 Me t a s t a bi l i t y ¢ A n y b i - sta b l e d ev i c e h a s tw o sta b l e sta tes a n d a me t a s t a bl e s t a t e be t we e n t he m ¢ A f l i p - fl o p h a s tw o sta b l e sta te s ( 1 a n d 0 ) a n d o n e me t a s t a bl e s t a t e ¢ If a f lip - f l o p l a n d s i n t h e m e t a s t a b l e s t a t e , i t c o u l d s t a y th er e fo r a n u n d eter m i n ed a m o u n t o f ti m e metastable stablestable C a r ne gi e M e l l on 28 Me t a s t a bi l i t y ¢ T 0 / T c d e s c ri b e s t h e p ro b a b i l i t y t h a t t h e i n p u t c h a n g e s a t a b a d t i m e , i . e . , d u ri n g t h e a p e rt u re t i m e P( t re s > t) = ( T 0 / T c ) e - t/ τ ¢ τ is a t im e c o n s t an t in d ic at in g h o w f as t t h e f lip - fl o p m o v es a w a y f ro m t h e m e t a s t a b l e s t a t e ; i t i s re l a t e d t o t h e d e l a y t h ro u g h t h e c ro s s - cou p l e d g a t e s i n t h e f l i p - fl o p ¢ I n s h o rt , i f a f l i p - f l o p s a m p l e s a m e t a s t a b l e i n p u t , i f y o u w a i t l o n g e n o u g h ( t ) , t h e o u t p u t w i l l h a v e re s o l v e d t o 1 o r 0 w i t h h i g h p ro b a b i l i t y . C a r ne gi e M e l l on 29 Sy n c h ro n i ze rs ¢ A s yn c h r o n o u s i n p u t s ( D ) a r e i n e v i t a b l e ( u s e r i n t e r f a c e s , s ys t e m s w i t h d i f f e r e n t c l o c k s i n t e r a c t i n g, e t c . ) . ¢ T h e go a l o f a s yn c h r o n i z e r i s t o m a k e t h e p r o b a b i l i t y o f f a i l u r e ( t h e o u t p u t Q s t i l l b e i n g m e t a s t a b l e ) l o w . ¢ A s yn c h r o n i z e r c a n n o t m a k e t h e p r o b a b i l i t y o f f a i l u r e 0 . D Q CLKSYNC C a r ne gi e M e l l on 30 Sy n c h ro n i ze r I n t e rn al s ¢ A s yn c h r o n i z e r c a n b e b u i l t w i t h t w o b a c k - to - ba c k f l i p - fl o p s. ¢ S u p p o s e t h e i n p u t D i s c h a n gi n g w h e n i t i s s a m p l e d b y F 1 . ¢ I n t e r n a l s i gn a l D 2 h a s ( T c - t se t u p ) t i m e t o r e s o l v e a 1 o r 0 . D Q D2 Q D2 T c t setup t pcq CLK CLK CLK t res metastable F1 F2 C a r ne gi e M e l l on 31 S y n c h r o n i z e r P r o b a b i l i t y o f F a i l u r e ¢ F o r e a c h s a m p l e , t h e p r o b a b i l i t y o f f a i l u r e o f t h i s s yn c h r o n i z e r i s : D Q D2 Q D2 T c t setup t pcq CLK CLK CLK t res metastable F1 F2 C a r ne gi e M e l l on 32 S y n c h r o n i z e r M e a n T i m e B e fo r e F a i l u r e ¢ I f t h e a s yn c h r o n o u s i n p u t c h a n ge s o n c e p e r s e c o n d , t h e p r o b a b i l i t y o f f a i l u r e p e r s e c o n d o f t h e s yn c h r o n i z e r i s s i m p l y P( f a ilure ) . ¢ I n ge n e r a l , i f t h e i n p u t c h a n ge s N t i m e s p e r s e c o n d , t h e p r o b a b i l i t y o f f a i l u r e p e r s e c o n d o f t h e s yn c h r o n i z e r i s : ¢ T h u s , t h e s yn c h r o n i z e r f a i l s , o n a v e r a ge , 1 / [ P ( f a i l u r e ) / s e c o n d ] Thi s i s c a l l e d t he me a n t i me be t we e n f a i l ur e s , M TB F: C a r ne gi e M e l l on 33 Ex a m p l e S yn c h r o n i z e r D D2 Q CLK CLK F1 F2 Su p p o s e : T c = 1/ 500 M H z = 2 n s τ = 2 0 0 ps T 0 = 150 ps t se t u p = 1 0 0 ps N = 10 e v e n t s p e r s e c on d Wha t i s t he pr o ba bi l i t y o f f a i l ur e ? M T B F ? P (f a i l ur e ) = = P (f a i l ur e )/ s e c o nd = = MT B F = C a r ne gi e M e l l on 34 Ex a m p l e S yn c h r o n i z e r D D2 Q CLK CLK F1 F2 Su p p o s e : T c = 1/ 500 M H z = 2 n s τ = 2 0 0 ps T 0 = 150 ps t se t u p = 1 0 0 ps N = 10 e v e n t s p e r s e c on d Wha t i s t he pr o ba bi l i t y o f f a i l ur e ? M T B F ? P (f a i l ur e ) = ( 1 5 0 p s / 2 n s ) e - ( 1. 9 n s ) / 200 ps = 5. 6 × 10 - 6 P (f a i l ur e )/ s e c o nd = 1 0 × ( 5. 6 × 10 - 6 ) = 5 .6 × 10 - 5 / se c o n d MT B F = 1 / [P ( f a i l u r e ) / s e c o n d ] ≈ 5 h ou r s C a r ne gi e M e l l on 35 Wh a t d id w e lea r n ? ¢ T i m i n g c o n s t r a i n t s f o r s e q u e n t i a l c i r c u i t s § Se t u p t im e , t i m e ne e de d f o r t he i nput s t o be pr e s e nt be f o r e c l o c k § Ho l d t i m e , t i m e ne e de d a f t e r t he c l o c k w he r e i nput s s ho ul d no t c ha ng e § Ap e r t u r e t i m e , t i m e a r o und c l o c k e v e nt w he r e i nput s s ho ul d s t a y s t a bl e ¢ Pro ble ms re la t e d t o c lo c k s ke w ¢ M e t a s t a b i l i t y a n d S yn c h r o n i z a t i o n","libVersion":"0.3.1","langs":""}