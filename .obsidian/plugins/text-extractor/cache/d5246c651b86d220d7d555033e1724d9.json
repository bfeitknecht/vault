{"path":"sem2/DDCA/UE/e/manual/DDCA-u06-manual.pdf","text":"1 LAB 6 – Te s t i ng th e ALU Go a l s • L e a rn how t o w ri t e t e s t be nc he s i n V e ri l og t o ve ri fy t he func t i ona l i t y of your de s i gn. • L e a rn t o fi nd a nd fi x probl e m s (bugs ) i n your de s i gn. To D o • Y ou w i l l w ri t e a V e ri l og t e s t be nc h to ve ri fy t ha t your A L U from L a b 5 w orks c orre c t l y. • W e w i l l provi de a n A L U c ode t ha t c ont a i ns bugs . U s i ng t he s a m e t e s t be nc h you us e d for t e s t i ng t he A L U from L a b 5, you w i l l fi nd a nd c orre c t t he bugs i n t he buggy ALU . • F ol l ow t he i ns t ruc t i ons . P a ra gra phs t ha t ha ve a gra y ba c kground l i ke t he c urre nt pa ra gra ph de not e de s c ri pt i ons t ha t re qui re you t o do s om e t hi ng. • To c omp l e te th e l ab you mu s t s h ow you r w or k b e for e th e d e ad l i n e , fol l ow i n g th e i n s tr u c ti on s p r ovi d e d b y th e as s i s tan t as s i gn e d to you r gr ou p . Th e r e is n oth i n g to h an d i n . Th e r e q u i r e d tas k s ar e c l e ar l y mar k e d w i th gr ay b ac k gr ou n d th r ou gh ou t th i s d oc u me n t. In t ro d u ct i o n In L a b 5 w e l e a rne d t ha t i t i s i m pra c t i c a l t o us e di re c t obs e rva t i on, l i ke w e di d i n e a rl i e r l a bs , t o ve ri fy t he func t i ona l i t y of c om pl e x c i rc ui t s . Ins t e a d, t hi s re qui re s a m e t hod t ha t a ut om a t i c a l l y ve ri fi e s w he t he r t he c i rc ui t w orks c orre c t l y. T hi s m e t hod i s us ua l l y c a l l e d fu n c t i on al v e r i fi c at i on . T he ba s i c i de a of s oft w a re - ba s e d func t i ona l ve ri fi c a t i on i s not di ffe re nt from w ha t we ha ve done s o fa r t o ve ri fy t he c orre c t ne s s of t he c i rc ui t s w e ha ve de s i gne d (i .e ., m a nua l l y c he c ki ng t h a t t he out put i s c orre c t for m ul t i pl e di ffe re nt i nput s ). H ow e ve r, i n t hi s l a b, t he func t i ona l ve ri fi c a t i on w i l l be pe rform e d aut om at i c al l y . T o a c hi e ve t hi s , w e w i l l i m pl e m e nt a s pe c i a l ki nd of V e ri l og m odul e , c a l l e d a t e s t be n c h . T he t e s t be nc h will: 1) A p p l y ar b i tr ar y i n p u ts to th e c i r c u i t u n d e r te s t. W e w i l l c a l l t hi s c i rc ui t t he uni t - unde r - t e s t (U U T ) . 2) C h e c k th e c or r e c tn e s s of th e ou tp u t. T he t e s t i nput s m a y e i t he r be ge ne ra t e d i ns i de t he t e s t be nc h m odul e us i ng be ha vi ora l m ode l i ng i n V e ri l og or l oa de d from a fi l e a s t e s t - ve c t ors , w hi c h i s a s e t of i nput da t a a nd t he e xpe c t e d re s ul t . If t he out put of t he U U T m a t c he s t he e xpe c t e d out put for a l l t e s t c a s e s (e .g., a l l pos s i bl e i nput s ), w e c oul d s a y t ha t t he i m pl e m e nt a t i on i s c orre c t . M a ki ng t he func t i ona l ve ri fi c a t i on a ut om a t i c e na bl e s m ore t e s t c a s e s t o be c he c ke d i n a s hort a m ount of t i m e c om pa re d t o put t i ng i n t he e qui va l e nt e ffort m a nua l l y . T hi s i s e s pe c i a l l y i m port a nt w he n t he i nput s pa c e i s l a rge . 2 T he re a re a ddi t i ona l a dva nt a ge s a s s oc i a t e d w i t h pe rform i ng func t i ona l ve ri fi c a t i on i n s oft w a re . O n a n F P G A , w e c a n onl y obs e rve t he out put s of t he t op m odul e . In c ont ra s t , w he n w e us e a s oft w a re t ool t ha t s i m ul at e s our c i r c ui t , w e a l s o ha ve a c c e s s t o a l l i nt e rna l m odul e s . T hi s m a ke s t ra c i ng bug s m uc h e a s i e r a nd s i gni fi c a nt l y re duc es t he t e s t i ng t i m e . S o fa r, w e ha ve us e d V e ri l og t o de s c ri be t he a c t ua l c i rc ui t . A s you ha ve l e a rne d i n c l a s s , w e c a n a l s o us e V e ri l og t o de s c ri be t e s t be nc h m odul e s t ha t : • i ns t a nt i a t e t he U U T , i .e ., t he m odul e t ha t you w oul d l i ke t o t e s t ; • de fi ne i nput s w i t h w hi c h t o t e s t t he U U T ; • c ol l e c t t he out put s ; • c om pa re t he out put s w i t h t he e xpe c t e d re s ul t s . In t hi s e xe rc i s e , w e w i l l i m pl e m e nt a t e s t be nc h i n V e ri l og a nd s i m ul a t e our A L U c i rc ui t from L a b 5. If t he re a re m i s t a ke s i n t he c i rc ui t , you c a n fi nd w ha t w e nt w rong a nd c orre c t t he m i s t a ke s . Pr e pa r a t i o n In t hi s l a b e xe rc i s e , w e w i l l c ont i nue us i ng t he V e ri l og de s c ri pt i on of t he A L U from L a b 5 . N ot e t ha t you s houl d us e t he A L U you de s i gne d i n t he m a nua l of L a b 5, not t he m odi fi e d ve rs i on from t he re port of L a b 5. Y ou ar e e xp e c te d to fi n i s h Lab 5 b e for e s tar ti n g w i th th e te s tb e n c h . D ow nl oa d t he .z i p fi l e us i ng t he l i nk be l ow . T he fi l e i nc l ude s a t e m pl a t e / e xa m pl e for a t e s t be nc h fi l e , t he t e m pl a t e for t he t e s t - ve c t ors , a nd a V e ri l og de s c ri pt i on of a n A L U , w hi c h c ont a i ns s om e bugs . ht t ps : / / s a fa ri .e t hz .c h / ddc a / s pri ng202 4 / l i b/ e xe / fe t c h.php? m e di a =l a b6_fi l e s .z i p Pa r t 1 - Ex p e c t e d R e s u l t s Be fore w e c a n s t a rt w ri t i ng our t e s t be nc h, w e ne e d t o pre pa re a s e t of i nput s t ha t w e know t he e xpe c t e d re s ul t s for. F or l a rge proj e c t s i t i s t ypi c a l l y pos s i bl e t o us e a gol de n m ode l t o fi nd t he e xpe c t e d out put for a gi ve n i nput . A gol de n m ode l c oul d be a ny i m pl e m e nt a t i on t ha t w e know i s c orre c t : f or e xa m pl e , i t c oul d be a not he r pre vi ous l y t e s t e d V e ri l og i m pl e m e nt a t i on of t he c i rc ui t , or a progra m w ri t t e n i n a hi gh - l e ve l l a ngua ge s uc h a s J a va , C++, M A T L A B or P yt hon. W e c oul d a l s o us e a s ys t e m a t i c w a y of ge ne ra t i ng s e ve ra l i nput s s o t ha t t he c i rc ui t i s ve ri fi e d t horoughl y 1 . In t hi s e xe rc i s e , you w i l l be gi ve n a s e t of i nput s for t he A L U de s i gne d i n L a b 5. D e t e rm i ne t he c orre c t ‘re s ul t ’ for e a c h of t he s e i nput s a nd, us i ng a t e xt e di t or, e nt e r t he m t o t he fi l e ‘t e s t ve c t ors _he x.t xt ’ t ha t w e provi de . 1 S i m ul a t i ng e a c h a nd e ve ry pos s i bl e i nput i s im pra c t i c a l . T he re fore , i t i s i m port a nt t o fi nd a s ubs e t of a l l i nput s t ha t ve ri fy m os t of t he func t i ona l i t y. Input s a re c hos e n s o t ha t a l l func t i ons of t he c i rc ui t a re t e s t e d, a nd a l l l i m i t s a nd s pe c i a l c a s e s a re c ove re d. 3 T hi s fi l e c ont a i ns i nput s for t he A L U . Y our t a s k i s t o fi l l i n t he e xpe c t e d va l ue of ‘re s ul t ’ i n he xa de c i m a l not a t i on. N ot e t ha t our A L U ha s a n a ddi t i ona l s i ngl e - bi t out put , c a l l e d ‘z e ro’. T he e xpe c t e d va l ue of t ha t out put c a n be e a s i l y de t e rm i ne d ba s e d on t he ‘re s ul t ’. T hus , w e c a n di re c t l y s e t i t s e xpe c t e d va l ue w i t hi n t he t e s t be nc h. If t he e xpe c t e d va l ue of ‘re s ul t ’ i s a l l z e ros , t he e xpe c t e d va l ue of t he s i gna l ‘z e ro’ s houl d be one . Pa r t 2 - Pr e pa r i ng t he Te s t be nc h In t hi s pa rt , w e w i l l c re a t e a t e s t be nc h m odul e a nd i m pl e m e nt our t e s t i ng l ogi c . Cre a t e a ne w RT L proj e c t a nd m a ke s ure V e ri l og i s s e l e c t e d a s t he s i m ul a t or l a ngua ge : S i nc e we w a nt t o t e s t t he A L U you i m pl e m e nt e d i n L a b 5, you ne e d t o i m port your A L U m odul e a s a s ourc e . We r e c om m e nd t hat y ou c he c k t he opt i on “ Copy s our c e s i nt o pr oj e c t ” whe n doi ng s o . T he n, ke e p c l i c ki ng “ N e xt ” a nd c om pl e t e proj e c t c re a t i on by c l i c ki ng “ F i ni s h” . A ft e r c re a t i ng t he proj e c t , you c a n s t a rt i m pl e m e nt i ng t he t e s t be nc h. F or t hi s e xe rc i s e , w e provi de you with a t e s t be nc h t e m pl a t e t ha t i s a l m os t c om pl e t e . T o us e t he provi de d fi l e , you fi rs t ha ve t o a dd t he fi l e t o t he proj e c t . Cl i c k “ A dd S ourc e s ” on t he l e ft - ha nd s i de a nd s e l e c t “ A dd or c re a t e s i m ul a t i on s ourc e s ” . T he n brow s e t o A L U _t e s t .v t ha t you dow nl oa de d. 4 T he ne w fi l e w i l l not be i m m e di a t e l y vi s i bl e i n t he proj e c t hi e ra rc hy. T hi s i s be c a us e , by de fa ul t , t he hi e ra rc hy onl y s how s t he “ D e s i gn S ourc e s ” . T o vi e w “ S i m ul a t i on S ourc e s ” , e xpa nd t he c orre s pondi ng fol de r. A ft e r a ddi ng t he A L U from L a b 5 a s a s ourc e , y ou s houl d s e e bot h t he A L U a nd t he t e s t be nc h i n t he proj e c t hi e ra rc hy. Y ou m us t m a ke a fe w m odi fi c a t i ons i n t he t e s t be nc h t o s i m ul a t e t he A L U prope rl y. O pe n t he t e s t be nc h fi l e A L U _t e s t .v a nd m a ke t he fol l ow i ng m odi fi c a t i ons . T he s e m odi fi c a t i ons a re a l s o i ndi c a t e d a s c om m e nt s i n t he t e s t be nc h fi l e . 1. D e c l a re a n a rra y t ha t i s bi g e nough t o hol d a l l our t e s t c a s e s a nd c a n s t ore t he i nput s al u op, a, b a nd t he e xpe c t e d va l ue of t he out put e xp_r e s u l t . D e c l a ri ng a rra ys i n V e ri l og i s not di ffe re nt from de c l a ri ng m ul t i - bi t s i gna l s . F or e xa m pl e , t o de c l a re a 4 - e l e m e nt a rra y of 5 - bi t re gs , you m us t w ri t e : r eg [4:0] e xamp l e _ar r ay [0:3]; 2. A dd a s t a t e m e nt t ha t re a ds t he c ont e nt s of t he ‘t e s t ve c t ors _he x.t xt ’ fi l e i nt o t he a rra y de c l a re d a bove . H i nt : Y ou c a n us e t he r e adm e m h func t i on (c he c k onl i ne for doc um e nt a t i on on how t o us e it ). W he n re a di ng t he fi l e , you c a n e i t he r s pe c i fy t he ful l pa t h t o t he fi l e or a dd t he fi l e t o t he V i va do proj e c t a nd di re c t l y us e its fi l e na m e . 3. G e ne ra t e t he va l ue of e xp_z e r o from t he e xp_r e s u l t . A s i m pl e a s s i gn s t a t e m e nt s houl d be s uffi c i e nt t o do t hi s . 4. In t he t e s t be nc h, i ns t a nt i a t e your A L U from L a b 5. E ns ure t ha t you c onne c t t he t e s t s i gna l s c orre c t l y t o t he m odul e you i ns t a nt i a t e d. S o fa r, w e de ve l ope d a t e s t be nc h t ha t w i l l a ppl y t he ve c t ors i n t he “ t e s t ve c t ors _he x.t xt ” fi l e a nd c he c k t he a c t ua l out put s of our A L U a ga i ns t w ha t w e e xpe c t t o s e e . N ow i t i s t i m e t o s i m ul a t e it a nd s e e t he re s ul t s . Pa r t 3 - Si m ul at i ng t he A L U T he re a re m a ny c om m e rc i a l s oft w a re - ba s e d s i m ul a t ors t ha t c a n be us e d t o s i m ul a t e V e ri l og c i rc ui t s . In t hi s e xe rc i s e , w e us e t he bui l t - i n s i m ul a t or from V i va do. M a ke s ure t ha t t he AL U _t e s t m odul e on t he hi e ra rc hy i s s e l e c t e d a s “ t op s i m ul a t i on m odul e ” . O n t he F l ow Nav i gat or w i ndow , l ook for ‘S i m ul a t i on’. E xpa nd ‘Run S i m ul a t i on’ a nd s e l e c t ‘Run Be ha vi ora l S i m ul a t i on’. If e ve ryt hi ng w orks fi ne , you s houl d s e e a w i ndow s i m i l a r t o t he one be l ow . In orde r t o vi e w t he e nt i re s i m ul a t i on pe ri od, you m a y ha ve t o ri ght - c l i c k t he w a ve form s w i ndow a nd s e l e c t ‘F ul l V i e w ’: 5 Fi g ure 1 . Vivado main window T he bot t om pa rt of V i va do c ont a i ns t he Tcl C ons ol e . T hi s i s ve ry i m port a nt , a s t he $di s pl ay m e s s a ge s w i t hi n t he t e s t be nc h w i l l be di s pl a ye d i n t hi s w i ndow . If t he s i m ul a t or di d not s t a rt , i t is m os t l i ke l y be c a us e i t e nc ount e re d a n e rror w hi l e c om pi l i ng your V e ri l og c ode . T he m os t c om m on c a us e for t hi s i s a s ynt a x e rror i n your t e s t be nc h. If t hi s ha ppe ns , s c rol l up i n t he T c l Cons ol e a nd l ook for “ERRO R:” m e s s a ge s t o he l p you t roubl e s hoot t he probl e m (s ). O nc e you know w ha t i t i s , e xi t t he s i m ul a t or, c orre c t t he e rror i n t he e di t or a nd re s t a rt t he s i m ul a t or by s e l e c t i ng ‘Run Be ha vi ora l S i m ul a t i on’. S i nc e i n t he t e s t be nc h w e ha ve a $f i ni s h s t a t e m e nt , t he s i m ul a t or w i l l a ut om a t i c a l l y s t op onc e $f i ni s h i s re a c he d . 2 T o run a l l s i m ul a t i ons , on t he t op pa rt of t he V i va do w i ndow you c a n c l i c k on ‘Run a l l ’ ( or pre s s F3 ) . T he s i m ul a t or w i l l t he n c ont i nue . E xa m i ne t he c ons ol e , m a ke s ure t ha t t he c i rc ui t i s w orki ng c orre c t l y. 2 T hi s ha ppe ns w he n a l l t he t e s t - ve c t ors ha ve be e n e xha us t e d. 6 Pa r t 4 - De b u g g i n g P r o b l e m s U s i ng a s i m ul a t or c a n he l p you l oc a t e t he probl e m s i n your c i rc ui t s . Y ou c a n not onl y obs e rve t he out put s but a l s o t he s t a t e of a l l i nt e r nal va ri a bl e s . N ow your t a s k i s t o pe rform a s i m ul a t i on t o fi nd a nd c orre c t bugs i n a V e ri l og m odul e . T he A L U w e provi de , ‘ba d_A L U .v’, i s s uppos e d t o w ork t he s a m e w a y a s your A L U , but i t c ont a i ns s om e i nt e nt i ona l m i s t a ke s t ha t re s ul t i n i nc orre c t be ha vi or , i n s om e c a s e s . A dd t he s ourc e ‘ba d_A L U .v’ i nt o your proj e c t . M odi fy your t e s t be nc h t o i ns t a nt i a t e ba d_A L U i ns t e a d of your A L U . S i m ul a t e t he c i rc ui t a nd s e e t he c a s e s t ha t re s ul t i n e rrors . T he re s houl d be a t l e a s t 7 e rrors (i n 12 t e s t - ve c t ors ). T he c ons ol e w i l l di s pl a y a l l c a s e s t ha t re s ul t e d i n a n e rror. In a ddi t i on t o t he c ons ol e , you c a n a l s o us e t he w a ve form . By de fa ul t , t he w a ve form w i ndow w i l l di s pl a y a l l va l ue s w i t h a pa rt i c ul a r r adi x (a l s o c a l l e d bas e ) t ha t de pe nd s on t he t ype of t he s i gna l . T o c ha nge t he ra di x, you c a n ri ght - c l i c k on t he s i gna l a nd hove r ove r “ R adi x ” . Y ou c a n s e l e c t m ul t i pl e s i gna l s to qui c kl y c ha nge t he ra di x of a l l of t he m a t t he s a m e t i m e . By s e l e c t i ng t he na m e of your i ns t a nc e (t ypi c a l l y c a l l e d uut ) i n t he hi e ra rc hy brow s e r, you w i l l be a bl e t o s e l e c t i nt e rna l s i gna l s of t he bad_AL U i n t he obj e c t s w i ndow . T hi s c a n be s e e n i n t he fi gure be l ow . Fi g ure 2 . uut is highlighted in “Scope” ; the bad_ALU’s internal signals are selected . Y ou c a n a dd a ny s i gna l i nt o t he w a ve form by ri ght - c l i c ki ng on t he s i gna l a nd t he n c l i c ki ng “ A dd t o t he W a ve W i ndow ” . T he w a ve form vi e w e r w i l l not i m m e di a t e l y di s pl a y va l ue s for t he s i gna l s you a dd. T o s e e t he va l ue s of t he ne w l y a dde d s i gna l s i n t he w a ve fo rm , you s houl d re s t a rt t he s i m ul a t i on t o l e t t he s i m ul a t or s a m pl e t he s e ne w s i gna l s . Y ou c a n re s t a rt 7 t he s i m ul a t i on by c l i c ki ng t he but t on w e s how be l ow , w hi c h i s l oc a t e d a t t he t op of t he w i ndow i n V i va do ( or by pre s s i ng t he s hort c ut C tr l + S h i ft+ F 5 ) : A ft e r re s t a rt i ng t he s i m ul a t i on, you will ne e d t o run t he s i m ul a t i on a ga i n. O nc e you ha ve done s o you s houl d be a bl e t o s e e a l l t he w a ve s . F i nd a nd c orre c t t he e rrors . T he c ode s houl d be ve ry c l os e t o w orki ng a nd s houl d not re qui re a m a j or re - w ri t e , but j us t a fe w s m a l l c orre c t i ons 3 . Re m e m be r t o s how t he w orki ng c i rc ui t t o your a s s i s t a nt . Is t he re a nyt hi ng e l s e w rong w i t h t he V e ri l og c ode of ba d_A L U ? Is i t pos s i bl e t ha t t he V e ri l og c ode i s not s ui t a bl e for s ynt he s i s e ve n t hough i t s i m ul a t e s c orre c t l y? (H i nt : L ook i n t he D e s i gn S um m a ry t o c om pa re t he pe rform a nc e a nd e ffi c i e nc y of t he c i rc ui t w i t h your A L U i m pl e m e nt a t i on i n L a b 5.) La s t W o r d s Y ou ha ve j us t us e d a s i m ul a t or t o ve ri fy a nd c orre c t a V e ri l og m odul e . A s i m ul a t or i s a bl e t o run m a ny t hous a nds of t e s t - ve c t ors i n a s hort pe ri od of t i m e a nd i s t he re fore m uc h fa s t e r t ha n ve ri fyi ng a l l out put s m a nua l l y. A ddi t i ona l l y, t he s i m ul a t or a l l ow s you t o l ook i ns i de t he c i rc ui t t o m oni t or i nt e rna l s i gna l s duri ng ope ra t i on. H ow e ve r, t he s i m ul a t or a l one i s i ns uffi c i e nt t o t e s t t he c i rc ui t . Y ou ne e d a t e s t be nc h t ha t c a n a ut om a t i c a l l y c he c k i f t he out put s a re c orre c t a nd , m os t i m port a nt l y, a w a y t o ge ne ra t e m e a ni ngful t e s t - ve c t ors a nd t he i r c orre s pondi ng e xpe c t e d re s pons e s . In pra c t i c a l de s i gns , de ve l opi ng t e s t be nc he s a nd a ut om a t e d ve ri fi c a t i on fl ow s a re a n i m port a nt pa rt of t he di gi t a l de s i gn proc e s s . T ypi c a l l y, m uc h m ore t ha n ha l f of t he de s i gn t i m e i s s pe nt i n ve ri fi c a t i on. 3 A s t he na m e i m pl i e s , t he c ode i s bad ! D o not t a ke t hi s c ode a s a n e xa m pl e of how t o w ri t e V e ri l og.","libVersion":"0.3.1","langs":""}