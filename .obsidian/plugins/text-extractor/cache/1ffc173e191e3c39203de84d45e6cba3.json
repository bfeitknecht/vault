{"path":"sem2/DDCA/UE/e/manual/DDCA-u04-manual.pdf","text":"1 LAB 4 – Fi ni t e - St a t e Ma c h i n e s Go a l s • L e a rn how t o i m pl e m e nt a fi ni t e - state m a c hi ne us i ng V e ri l og. • D e s i gn a nd i m pl e m e nt a s i m pl e c i rc ui t t ha t e m ul a t e s t he bl i nki ng l i ght s of a F ord T hunde rbi rd. To D o • U nde rs t a nd how t he c l oc k s i gna l i s de ri ve d i n t he F P G A boa rd. • W ri t e a n F S M t ha t i m pl e m e nt s t he F ord T hunde rbi rd bl i nki ng s e que nc e . • F ol l ow t he i ns t ruc t i ons . P a ra gra phs t ha t ha ve a gra y ba c kground l i ke t he c urre nt pa ra gra ph de not e de s c ri pt i ons t ha t re qui re you t o do s om e t hi ng. • To c omp l e te t h e l ab you mu s t s h ow you r w or k b e for e th e d e ad l i n e , fol l ow i n g th e i n s tr u c ti on s p r ovi d e d b y th e as s i s tan t as s i gn e d to you r gr ou p . Th e r e is n oth i n g to h an d i n . Th e r e q u i r e d tas k s ar e c l e ar l y mar k e d w i th gr ay b ac k gr ou n d th r ou gh ou t th i s d oc u me n t. In t ro d u ct i o n U nt i l now , w e ha ve onl y i m pl e m e nt e d c om bi na t ori a l c i rc ui t s i n V e ri l og. In t hi s e xe rc i s e , w e w i l l i m pl e m e nt c i rc ui t s w i t h s t a t e s , i .e ., s e que nt i a l l ogi c c i rc ui t s . P l e a s e re fe r t o L e c t ure s 6 a nd 7a t o unde rs t a nd s e que nt i a l l ogi c . In t hi s l a b, you w i l l de s i g n a fi ni t e - state m a c hi ne t o c ont rol t he t a i l l i ght s of a 1965 F ord T hunde rbi rd. T he re a re t hre e l i ght s on e a c h s i de t ha t ope ra t e i n s e que nc e t o i ndi c a t e t he di re c t i on of a t urn. F i gure 1 s how s t he t a i l l i ght s a nd F i gure 2 s how s t he fl a s hi ng s e que nc e for (a ) l e ft t urns a nd (b) ri ght t urns . 1 1 T hi s l a b i s de ri ve d from a n e xa m pl e by J ohn W a ke rl y from t he 3 rd E di t i on of D i gi t a l D e s i gn. ! ZOTTF FS C A LIF O R N IA RA RB RCLC LB LA Co p yrig h t © 2 0 0 0 b y Pre n tice H a ll, In c. D ig ita l D e sig n Prin cip le s a n d P ra ctice s , 3 /e 2 Fi g u r e 1 . Th u n d e r b i r d Ta i l Li g h t s Fi g u r e 2 . Fl a s h i n g S e q u e n c e ( s h a d e d l i g h t s a r e i l l u m i n a t e d ) Pa r t 1 – FSM D e s i g n L e t us s t a rt w i t h de s i gni ng t he s t a t e t ra ns i t i on di a gra m for t hi s F S M . G i ve e a c h s t a t e a na m e a nd re m e m be r t o a s s i gn a va l ue t o every out put ( LC , LB, LA , R A , R B, R C ) i n e a c h s t a t e . Y our F S M s houl d t a ke t hre e i nput s : reset , l e ft , a nd r i gh t . T he c i rc ui t s houl d ha ve t he fol l ow i ng prope rt i e s : • O n re s e t , t he F S M s houl d e nt e r a s t a t e w i t h a l l l i ght s off. • W he n you pre s s l e ft , you s houl d s e e L A , t he n L A a nd L B, t he n L A , L B, a nd L C, t he n fi na l l y a l l l i ght s off a ga i n . T hi s i s i l l us t ra t e d i n F i gure 2 (a ) . • T hi s pa t t e rn s houl d oc c ur e ve n i f you re l e a s e l e ft duri ng t he s e que nc e . If l e ft is still dow n w he n you re t urn t o t he l i ght s off s t a t e , t he pa t t e rn s houl d re pe a t . • W he n you pre s s r i gh t , you s houl d s e e RA , t he n RA a nd RB, t he n RA , RB, a nd RC, t he n fi na l l y a l l l i ght s off a ga i n. T hi s i s i l l us t ra t e d i n F i gure 2 (b). • It i s up t o you t o de c i d e w ha t t o do i f t he us e r m a ke s l e ft a nd r i gh t s i m ul t a ne ous l y t rue . H ow e ve r, be s ure t o m a ke a c hoi c e — t hi s w i l l ke e p your de s i gn s i m pl e a nd m a ke w ri t i ng t he V e ri l og c ode a l ot e a s i e r . ! LC(a) LB LA RA(b) RB RC Copyright © 2000 by Prentice Hall, Inc. Digital Design Principles and Practices, 3/e 3 1a) U s i ng a pe n, dra w t he s t a t e t ra ns i t i on di a gra m . Indi c a t e t he i nput c ondi t i ons t ha t c a us e t ra ns i t i ons a m ong s t a t e s . U s e t he 1 - bi t s i gna l s ‘l e ft’ a nd ‘r i gh t’ for t he di re c t i on i ndi c a t or. T he s e w i l l be t he c i rc ui t ’s i nput s . T he j ob of a n F S M i s t o do t hre e t hi ngs : 1. D e t e rm i ne t he ne xt s t a t e from t he pre s e nt s t a t e a nd t he i nput s (ne xt s t a t e l ogi c ). 2. D e t e rm i ne t he out put s i gna l s ba s e d on t he pre s e nt s t a t e a nd i nput s i gna l s (out put l ogi c ) . 3. A dva nc e from t he pre s e nt s t a t e t o ne xt s t a t e w he n a c l oc k e ve nt a rri ve s (s t a t e re gi s t e r). In s e c t i on 3.4 of t he H & H t e xt book, you s e e how t o pre pa re a s t a t e t ra ns i t i on t a bl e . T hi s i s e s s e nt i a l l y a t ra ns l a t i on of t he s t a t e di a gra m s i nt o a t a bl e form s o t ha t w e c a n us e our know l e dge i n de s i gni ng c om bi na t ori a l c i rc ui t s t o de ri ve t he Bool e a n e qua t i ons for ne xt s t a t e l ogi c a nd out put l ogi c . 1b ) A l ong w i t h your s t a t e t ra ns i t i on di a gra m , a dd a s m a l l t a bl e de s c ri bi ng how you w i l l m a p t he s t a t e s t o bi na ry va l ue s . T he ne xt s t e p i s t he out put m a ppi ng. T he re a re s i x out put s i gna l s dri v i ng t he t a i l l i ght s : LA , LB, LC , R A , R B, R C . T he out put l ogi c t a bl e de fi ne s t he va l ue s of out put s i gna l s a t e a c h s t a t e . W e us e t hi s de s c ri pt i on t o de ri ve our out put l ogi c . 1c ) A l ong w i t h your s t a t e t ra ns i t i on di a gra m , a dd a s m a l l t a bl e or a t e xt / ps e udoc ode de s c ri pt i on of how you w i l l m a p t he s t a t e s t o t he se s i x out put s i gna l s . N ow t ha t w e ha ve a de s i gn, we a re re a dy t o s t a rt our proj e c t ! Pa r t 2 – Ve r i l o g I m p l e m e n t a t i o n Re fe r t o e a rl i e r l a bs i f you ha ve probl e m s w i t h c re a t i ng a ne w proj e c t . A Mat t e r of St y l e T he s ynt a x of ha rdw a re de s c ri pt i on l a ngua ge s w i l l a l l ow you t o w ri t e t he s a m e F S M i n a num be r of di ffe re nt w a ys . P l e a s e re fe r t o L e c t ure 7b for t he be s t pra c t i c e s . W e e xpe c t you t o c l e a rl y s e pa ra t e t he fol l ow i ng t hre e c om pone nt s : • t he s t a t e re gi s t e r ( t hi s re gi s t e r ke e ps t ra c k of t he pre s e nt s t a t e ; a t e ve ry c l oc k c yc l e , t he pre s e nt s t a t e i s re pl a c e d by t he ne xt s t a t e ) ; • t he ne xt s t a t e l ogi c (w he re t he ne xt s t a t e i s de t e rm i ne d by t he pre s e nt s t a t e a nd c urre nt i nput s ) ; • t he out put l ogi c (w he re t he out put s a re de t e rm i ne d by t he pre s e nt s t a t e a nd i nput s ) ; 4 Fi g u r e 3 . A s i m p l e v i e w o f a n FS M . It i s a l s o good pra c t i c e t o na m e your s i gna l s i nt ui t i ve l y. If you w a nt t o know how e ve ry re gi s t e re d s i gna l i s c onne c t e d, pl e a s e re fe r t o F i gure 3. In t hi s e xa m pl e , t he re a re t w o s i gna l s a s s oc i a t e d w i t h t he ‘s tate ’ . T he ne xt s t a t e s i gna l i s c a l l e d ‘s tate _n ’ ( s hort for “ s t a t e - ne xt ” ) a nd t he pre s e nt s t a t e s i gna l i s c a l l e d ‘s tate _p ’ ( s hort for “ s t a t e - pre s e nt ”) . T hi s i s j us t a n e xa m pl e , but i t i s good pra c t i c e t o us e t he s a m e ‘b as e n ame ’ a nd t o a dd s om e i de nt i fi e rs a s a s uffi x t o di ffe re nt i a t e t he pre s e nt a nd ne xt s t a t e s . In t hi s w a y, you a re a l w a ys a bl e t o di s t i ngui s h w hi c h s i gna l s a re re gi s t e re d. N ot e t ha t your t e xt book doe s not fol l ow t he s a m e na m i ng c onve nt i on. If w e us e a ha rdw a re de s c ri pt i on l a ngua ge (e .g., V e ri l og or V H D L ) w e do not ne e d t o e xpl i c i t l y fi l l a s t a t e t ra ns i t i on t a bl e , be c a us e w e w i l l us e t he c om pi l e r t o fi rs t m a p t he be ha vi or t o Bool e a n e qua t i ons , a nd t he n a ut om a t i c a l l y t o l ogi c ga t e s . M os t i m port a nt l y, be c on s i s te n t i n th e w ay you w r i te c od e . T hi s a l l ow s you t o m ore e a s i l y va l i da t e , re us e a nd s ha re c ode w i t h ot he rs . S t a rt V i va do a nd c re a t e a ne w proj e c t . Cre a t e a V e ri l og s ourc e fi l e t o i m pl e m e nt t he fi ni t e - s t a t e m a c hi ne us i ng w ha t your know l e dge of V e ri l og. B e s ur e t o i nc l ude a c l oc k ( clk ) and a r e s e t s i gnal ( rst ) as i nput s t o y our c i r c ui t . Pa r t 3 - Im p l em en t i n g t h e C l o ck Y ou de s c ri be d a c l oc k i nput ( clk ) i n your c i rc ui t . W he re do es t hi s c l oc k c om e from ? Y ou m i ght be t e m pt e d t o us e one of t h e F P G A ’s pus h but t ons or s w i t c he s for t hi s purpos e . T hi s i s not a good i de a : t he s e m e c ha ni c a l c om pone nt s ge ne ra l l y do not t ra ns i t i on from one l ogi c - l e ve l t o a not he r one c l e a nl y . A n e xa m pl e of s uc h a noi s y t ra ns i t i on i s s how n i n F i gure 4. 5 Fi g u r e 4 . Pu s h - b ut t on bounc e ( t ake n f r om w w w . l abbookpage s . c o. uk) W ha t c a us e s bounc es , a s t he s e noi s y t ra ns i t i ons a re know n, i s t ha t t he ra t e of c ha nge i n a pus h but t on i s ve ry s l ow c om pa re d t o t he s pe e d of t he F P G A (m ore t ha n a m i l l i on t i m e s s l ow e r). D uri ng t he s l ow t ra ns i t i on, t he F P G A s e e s m a ny fa s t - oc c urri ng t ra ns i t i ons a nd i nt e rpre t s e a c h of t he m a s a c l oc k e dge . U s ua l l y i t i s pos s i bl e t o us e de bounc i ng c i r c ui t s a nd s a m pl i ng t e c hni que s t o pre ve nt t hi s . P us h but t ons w i l l not w ork — w e ne e d a s a fe r w a y t o ge ne ra t e t he c l oc k s i gna l . If you l ook a t your boa rd, you m a y not i c e t he t e xt “ CL K100Mhz (W5)” . In fa c t , your boa rd c ont a i ns a 100M hz c rys t a l os c i l l a t or c i rc ui t . T he out put of t hi s os c i l l a t or i s c onne c t e d t o t he pi n W 5 (w hi c h i s a s pe c i a l c l oc k pi n for t hi s F P G A ). W e w i l l s i m pl y m a ke s ure i n our de s i gn t o c onne c t t he ne t “ c l k” t o t he pi n W 5 us i ng t he c ons t ra i nt s fi l e (X D C). In t hi s w a y, w e w i l l ha ve a c l e a n c l oc k s i gna l . W e w i l l t a ke c a re of t hi s i n P a rt 4, w he n w e de fi ne t he c ons t ra i nt s . N ow w e ha ve a di ff e re nt pra c t i c a l probl e m : t he c l oc k i s t oo fa s t . 100 M H z m e a ns t ha t e ve ry c l oc k pe ri od i s 10 na nos e c onds l ong. T he e nt i re bl i nki ng s e que nc e w oul d be t he n 40 ns . T hi s i s a ve ry s hort t i m e : a hum a n ne e ds a t l e a s t a fe w m i l l i s e c onds (fi ve orde rs of m a gni t ude l a rge r t ha n 40 ns ) t o re c ogni z e a n i m a ge . If w e w a nt t o s e e our s e que nc e , w e ne e d t o fi nd a w a y t o dra m a t i c a l l y s l ow dow n t he c i rc ui t . T hi s c a n be a c hi e ve d i n t w o w a ys . W e c a n e i t he r i m pl e m e nt a c l oc k di vi de r c i rc ui t t ha t di vi de s t he c l oc k by a fe w m i l l i on t i m e s , or w e c a n ge ne ra t e a n e na bl e s i gna l e ve ry fe w m i l l i on c yc l e s , a nd t he n us e t hi s e na bl e s i gna l t o c ont rol our ne xt s t a t e t ra ns i t i on. In t hi s e xe rc i s e , w e w i l l gi ve you a s m a l l c l oc k di vi de r c i rc ui t ( c l k _di v ) t ha t t a ke s a s i nput t he ‘c l k ’ a nd ‘r s t ’ s i gna l s a nd ge ne ra t e s a ‘ c l k _e n ’ s i gna l e ve ry 33’554’432 c yc l e s (or onc e e ve ry 2 25 c yc l e s ). Cons i de ri ng t ha t t he m a i n c l oc k fre que nc y i s 100’000’000 c yc l e s pe r s e c ond, t hi s m e a ns a ‘ c l k _e n ’ s i gna l i s ge ne ra t e d e ve ry 0.335s . 6 module clk_div(input clk, input rst, output clk_en); reg [24:0] clk_count; always @ (posedge clk) // posedge defines a rising edge (transition from 0 to 1) begin if (rst) clk_count <= 0; else clk_count <= clk_count + 1; end assign clk_en = &clk_count; endmodule T he i de a i s s i m pl e : w e i nc re m e nt a 25 - bi t c ount e r (c a l l e d c l k _c nt ) a t e ve ry c l oc k c yc l e a nd set c l k _e n t o ‘1’ w he n a l l t he bi t s of t he c ount e r a re ‘1’. By i nc re a s i ng t he c ount e r size, you c a n c ha nge t he di vi s i on fa c t or a s you pl e a s e . M a ke t he ne c e s s a ry c ha nge s t o i nt e gra t e t hi s di vi de r i nt o your c ode . W e re c om m e nd t ha t you c re a t e a s e c ond V e ri l og fi l e a nd a dd t he c l k _di v a s a s e c ond m odul e t o t he proj e c t . T he n you c a n i ns t a nt i a t e t he c l k _di v i n your t op m odul e . In t he t op m odul e , you ha ve t o m odi fy t he ‘s t a t e re gi s t e r’, s o t ha t i t onl y upda t e s t he s t a t e w he n t he c l k _e n s i gna l i s ‘1’. W e e nc oura ge you t o pl a y w i t h t he fre que nc y of t he c l k _e n s i gna l t o t e s t how fa s t your e ye c a n c a pt ure a bl i n ki ng l i ght . If you s e e t he l i ght not bl i nki ng but w e a ke r t ha n us ua l , i t m e a ns t ha t your e ye i s j us t a ve ra gi ng t he bri ght ne s s of t he l i ght . I n t h is c a s e , your e ye i s not de t e c t i ng t he bl i nki ng l i ght . Pa r t 4 – De f i n i n g t h e Co n s t r a i n t s N ow , a l l w e ha ve t o do i s t o c hoos e w hi c h but t ons on t he boa rd w e w a nt t o us e for t he c ont rol , a nd w hi c h L E D s w e w i l l us e a s t a i l l i ght s . T he re fore , w e ne e d t o provi de a c ons t ra i nt s fi l e t o t e l l V i va do w he re w e w a nt t o c onne c t our pi ns . A dd a nd ope n a ne w c ons t ra i nt fi l e t o your proj e c t . Re fe r t o L a b 2 for m ore i nform a t i on. E nt e r t he fol l ow i ng c ons t ra i nt s i nt o your c ons t ra i nt s fi l e . M a ke s ure t ha t you ha ve c ons i s t e nt port na m e s i n t he c ons t ra i nt s fi l e a nd your t op m odul e . 7 # Clock signal set_property PACKAGE_PIN W5 [get_port s clk] set_property IOSTANDARD LVCMOS33 [get_ports clk] create_clock - period 10 - waveform {0 5} [get_ports clk] # LEDs set_property PACKAGE_PIN U14 [get_ports LC] set_property PACKAGE_PIN U15 [get_ports LB] set_property PACKAGE_PIN W18 [get_por ts LA] set_property PACKAGE_PIN U19 [get_ports RA] set_property PACKAGE_PIN E19 [get_ports RB] set_property PACKAGE_PIN U16 [get_ports RC] set_property IOSTANDARD LVCMOS33 [get_ports {LC LB LA RA RB RC}] # Buttons set_property PACKAGE _PIN W19 [get_ports left] set_property PACKAGE_PIN U18 [get_ports reset] set_property PACKAGE_PIN T17 [get_ports right] set_property IOSTANDARD LVCMOS33 [get_ports {left reset right}] O ur de s i gn i s now re a dy t o be i m pl e m e nt e d. U s i ng t he pre vi o us l a bs a s a gui de , ge ne ra t e t he bi t s t re a m fi l e of your c i rc ui t a nd dow nl oa d i t t o t he F P G A boa rd. S how your a s s i s t a nt t ha t t he c i rc ui t i s w orki ng c orre c t l y. La s t W o r d s O nc e a ga i n i n t hi s l a b e xe rc i s e , you ha d t o m a ke s e ve ra l de c i s i ons . Choos i ng t he s t a t e e nc odi ng i s s uc h a de c i s i on: • Y ou c oul d de s i gn a n F S M w i t h s e ve n s t a t e s . Y ou m a y c hoos e t o de c ode t he s e ve n s t a t e s w i t h a t l e a s t t hre e bi t s . If you do t hi s , you w i l l s a v e on t he num be r of state - hol di ng re gi s t e rs , but you w i l l ne e d a l a rge r out put de c odi ng c i rc ui t to de ri ve t he L E D c ont rol s from t he s t a t e . T hi s w i l l be a s i m i l a r t o t he de c ode r c i rc ui t t ha t w e de s i gne d i n L a b 3. Ins t e a d of 4 i nput s a nd 7 out put s , w e ha ve 3 i nput s a nd 6 out put s . • Y ou c oul d us e 6 bi t s t o de c ode t he s e ve n s t a t e s c l e ve rl y, a nd di re c t l y us e t he out put of t he s t a t e re gi s t e r to dri v e t he L E D s . T hi s w i l l s a ve you t he out put de c ode r, but you w i l l ne e d t w i c e t he num be r of s t a t e - hol di ng fl i p - fl ops . • O ne ot he r opt i on i s t o re a l i z e t he fa c t t ha t t he l e ft a nd ri ght bl i nki ng ope ra t i ons a re e s s e nt i a l l y t he s a m e . P e rha ps i t w oul d be pos s i bl e t o de s i gn j us t one s t a t e m a c hi ne a nd us e i t t w i c e ? T he re i s no c l e a r be t t e r c hoi c e . A s you de s i gn m ore c i rc ui t s , you w i l l de ve l op your i nt ui t i on, a nd e ve n your ow n pre fe re nc e s . U nt i l now w e w e re a bl e t o s e e w he t he r ou r c i rc ui t s func t i one d c orre c t l y by di re c t l y obs e rvi ng t he m . T hi s i s onl y pos s i bl e be c a us e our c i rc ui t s ha d ve ry fe w out put s , a nd i t di d not t a ke m uc h t i m e t o go t hrough a l l of t he m . W i t h t he c om i ng e xe rc i s e s , t hi s w i l l s t a rt t o c ha nge , a nd w e w i l l ne e d be t t e r m e t hods t o s e e i f our c i rc ui t a c t ua l l y w orks . 8 P ar t 1a P ar t 1b P ar t 1c","libVersion":"0.3.1","langs":""}