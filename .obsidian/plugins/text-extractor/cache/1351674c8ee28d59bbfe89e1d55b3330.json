{"path":"sem4/CN/VRL/extra/slides/CN-s15-CDN.pdf","text":"Computer Networks: Content-Distribution Networks (CDNs)* Jonghoon Kwon Some slides by Ankit Singla Photo: ETH Zürich / Gian Marco Castelberg *Also called content-delivery networks Most Internet traffic is delivered via CDNs 2 Content Delivery Networks (CDNs) will carry 72 percent of Internet traffic by 2022 up from 56 percent in 2017. Cisco Visual Networking Index: Forecast and Trends, 2017–2022 CDNs optimize web traffic through caching and replication 3 • After fetching resource for a client, also store it in a cache • Like caching DNS records at DNS resolvers • Saves time for your browser and decreases network and server load • Place content that will likely be requested close to clients • Can distribute load over multiple servers • Optimize latency of requests Caching Reactive Replication Proactive Caching Reactively cache content requested by clients 4 Popular content is fetched often and changes slowly • How many times per day do you fetch the Google logo? • How often does it actually change? 5 1998 1999 2010 2013 2015 Source: Wikipedia, Google Large amounts of data are uncacheable 6 • Dynamic data: some data is inherently dynamic (weather, stock prices, …) • Scripts: results can be based on parameters • Cookies: content is specific to a user/session • TLS/QUIC: encrypted content can only be accessed by endpoints (not in the network) • Advertising: content provider wants to measure number of accesses (and earn $$$) To limit staleness of cached objects, HTTP enables a client to validate cached objects 7 • Server hints when an object expires (kind of TTL) as well as the last modified date of an object • Client conditionally requests a resource using the “if-modified-since” header in the HTTP request • Server compares this against “last modified” time of the resource and returns - “Not Modified” if the resource has not changed - “OK” with the latest version otherwise 8 • Browser cache Client • Forward proxy • CDNs Close to the client • Reverse proxy Close to the destination Caching can be and is performed at different locations 9 clients request This increases server's and network’s load, while clients experience unnecessary delays Many clients request the same informationReverse proxies cache documents close to servers, decreasing their load 10 clients request reverse proxy This is typically done by content provider 11 Forward proxies cache documents close to clients reducing latency and network utilization 12 reverse proxy forward proxies This is typically done by ISPs or enterprises clients request Global replication Actively bring content closer to clients 1314 300ms Ktrinko [CC0], via Wikimedia Commons 15 Why do we want to distribute content? 16 • Fault tolerance - Service remains available (at least partially) even if some datacenter or network fails • Load balancing - Distribute requests over multiple servers - (Could be solved with multiple servers in one location) • Optimize latency - Requests are directed to “nearby” server • Network inefficiency - No need to transmit data across the globe 17 1. Spread the content servers globally 18 2. Network the sites and the origin 19 3. Direct clients to appropriate servers 20 1. Spread the content servers globally 21Image adapted from: “TelehouseDocklands”, John Arundel. CC BY-SA 3.0 via Wikipedia Optimize network distance: place content at Internet exchange points (IXPs) Here: London Internet Exchange (LINX) 22Adapted from image by Stefan Funke from Frankfurt, Germany (Switch Rack, Uploaded by MainFrame) [CC BY-SA 2.0], via Wikimedia Commons Optimize network distance: place content at Internet exchange points (IXPs) Here: DE-CIX in Frankfurt Equinix MI1-Miami NAP of America 23Submarine cable map: submarinecablemap.com 24 2. Network the sites and the origin How to transmit data between sites? 25 + Full control over network paths + High predictability of available bandwidth - $$$$ - Potentially low redundancy → Only very large companies have their own global networks Private network + Simple and (relatively) cheap + Available everywhere + Can use multiple providers for redundancy - Paths are unpredictable and often suboptimal - Bandwidth is not predictable Internet Internet routing can be circuitous 26 a b Internet routing can be circuitous 27 Taipei, Taiwan Putian, China 500Km (2.5ms) Internet routing can be circuitous 28 Taipei, Taiwan Putian, China https://www.submarinecablemap.com Internet routing can be circuitous 29 a b 1 140.109.17.1 1.857 ms 1.830 ms 1.819 ms 2 140.109.254.65 1.024 ms 0.964 ms 0.965 ms 3 140.109.254.29 1.702 ms 1.851 ms 2.036 ms 4 140.109.254.5 0.862 ms 0.895 ms 0.942 ms 5 202.169.174.1 1.320 ms 1.269 ms 1.433 ms 6 202.169.174.226 126.510 ms 126.498 ms 126.936 ms 7 4.59.4.1 276.592 ms 276.389 ms 276.527 ms 8 4.69.152.145 127.712 ms 127.741 ms 127.682 ms 9 4.53.210.110 128.843 ms 4.53.210.118 129.030 ms 4.53.210.114 128.602 ms 10 202.97.50.69 131.517 ms 131.466 ms 131.446 ms 11 202.97.50.117 305.707 ms 305.464 ms 305.652 ms 12 202.97.34.49 270.524 ms 270.410 ms 270.370 ms 13 202.97.50.225 306.119 ms 202.97.33.141 282.095 ms 202.97.50.241 277.718 ms 14 * * * 15 218.86.44.170 316.692 ms 316.784 ms 316.585 ms 16 218.6.10.242 291.273 ms 218.6.10.182 290.361 ms 218.6.10.166 297.248 ms 17 125.78.249.22 346.717 ms 218.6.10.138 296.387 ms 125.78.249.22 339.006 ms 18 125.78.249.22 335.653 ms 218.6.23.37 290.276 ms 290.287 ms Taipei, Taiwan Putian, China San Jose, USA Internet routing can be circuitous 30 Taipei, Taiwan Putian, China San Jose, USA Choosing paths using overlay routing 31 x a b lab > lax + lxb Choosing paths using overlay routing 32 x a b This is not free: you’re now paying twice! How well does overlay routing work? 33 Old study from 1999 • “The end-to-end effects of Internet path selection” - 4 university-based measurement nodes - Evaluate direct Internet path to several targets - Evaluate indirect path through an overlay node - RTTInternet — RTToverlay (ms) > 0 ⇒ overlay wins Similar measurements in paper evaluating SCIONLab (2020) “SCIONLab: A Next-Generation Internet Testbed” https://dl.acm.org/doi/10.1145/316194.316233 https://netsec.ethz.ch/publications/papers/icnp2020_scionlab.pdf Overlay routing can achieve lower latency and loss 34 RTTInternet — RTToverlay (ms) CDF The end-to-end effects of Internet path selection Overlay routing can achieve lower latency and loss 35 RTToverlay — RTTInternet (ms) SCIONLab: A Next-Generation Internet Testbed 36 Monitor latency, loss on routes! 150ms 160ms 170ms 80ms 270ms 140ms 120ms 330ms 180ms 37 400msSYN ACK SYN ACK GET Packets 400ms ACK Packets 400ms … … Tweaking transport for speed 38 SYN ACK SYN GET GET Packets ACK Packets 50ms 400ms Even bigger advantage for encrypted sessions! Tweaking transport for speed Ktrinko [CC0], via Wikimedia Commons 39 3. Direct clients to appropriate servers 40Adapted from image by Emile Aben [CC BY-SA 2.5], via Wikimedia Commons • Always use same IP address (or small set of addresses) • Addresses are advertised via BGP from multiple locations • Closest location is found by BGP • Same approach as open DNS resolvers (e.g., 9.9.9.9) • Return different IP addresses based on - resolver’s geo-localization - server load (à load balancing) There are two different ways to direct clients to the closest server 41 DNS-based BGP-anycast-based • Use short TTL of DNS records to prevent caching + “Simple”: optimization is done by BGP - Less precise control - Longer reconfiguration times + Very high control + Dynamic changes are possible - Complicated - Potential issues when clients do not use their local resolver DNS-based BGP-anycast-based Both approaches have advantages and drawbacks 42 • Akamai • Amazon CloudFront • Cloudflare • Fastly DNS-based BGP-anycast-based Both approaches are used in practice 43 <html> … <img src=“http://www.abc.com/bigpicture.jpg”> … </html> DNS-based CDN: URL rewriting 44 cdnurl.abc.com Manipulate DNS for the rest DNS-based CDN: DNS customized by location 45 Client’s ISP Local DNS resolver cdn.abc.com ? Name server cdn.abc.com ? x.cdn.net CDN Name server x.cdn.net ? l.m.n.o DNS response depends on Local DNS resolver’s guessed location CDN cluster GET … DNS-based CDN: DNS customized by location 46 Client’s ISP Local DNS resolver cdn.abc.com ? Name server cdn.abc.com ? x.cdn.net CDN Name server x.cdn.net ? l.m.n.o DNS response depends on Local DNS resolver’s guessed location CDN cluster GET … What if the client isn’t using the local DNS resolver? Let’s see some examples! DNS-based: Akamai used by cnn.com Anycast-based: Fastly used by reddit.com 47 DNS-based CDN: Akamai used by cnn.com Page source shows static content at cdn.cnn.com 48 DNS-based CDN: Akamai used by cnn.com CNAME record points to Akamai 49 $ dig cdn.cnn.com ; <<>> DiG 9.11.3-1ubuntu1.11-Ubuntu <<>> cdn.cnn.com ;; global options: +cmd ;; Got answer: ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 38776 ;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 512 ;; QUESTION SECTION: ;cdn.cnn.com. IN A ;; ANSWER SECTION: cdn.cnn.com. 284 IN CNAME ion-ma.turner.com.edgekey.net. ion-ma.turner.com.edgekey.net. 228 IN CNAME e12596.dscj.akamaiedge.net. e12596.dscj.akamaiedge.net. 20 IN A 23.36.225.200 ;; Query time: 8 msec ;; SERVER: 192.168.1.1#53(192.168.1.1) ;; WHEN: Mon May 09 09:33:50 CEST 2022 ;; MSG SIZE rcvd: 136 DNS-based CDN: Akamai used by cnn.com Different latencies measured from different places 50https://tools.keycdn.com/ping DNS-based CDN: Akamai used by cnn.com IP address depends on resolver’s location 51https://www.digwebinterface.com Anycast-based CDN: Fastly used by reddit.com Static content served from redditstatic.com 52 Anycast-based CDN: Fastly used by reddit.com CNAME record points to Fastly 53 $ dig www.redditstatic.com ; <<>> DiG 9.11.3-1ubuntu1.11-Ubuntu <<>> www.redditstatic.com ;; global options: +cmd ;; Got answer: ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 42168 ;; flags: qr rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 512 ;; QUESTION SECTION: ;www.redditstatic.com. IN A ;; ANSWER SECTION: www.redditstatic.com. 175 IN CNAME dualstack.reddit.map.fastly.net. dualstack.reddit.map.fastly.net. 2 IN A 151.101.1.140 dualstack.reddit.map.fastly.net. 2 IN A 151.101.65.140 dualstack.reddit.map.fastly.net. 2 IN A 151.101.129.140 dualstack.reddit.map.fastly.net. 2 IN A 151.101.193.140 ;; Query time: 2 msec ;; SERVER: 192.168.1.1#53(192.168.1.1) ;; WHEN: Mon May 09 10:00:59 CEST 2022 ;; MSG SIZE rcvd: 158 Anycast-based CDN: Fastly used by reddit.com Same latencies measured from different places https://tools.keycdn.com/ping 54 Anycast-based CDN: Fastly used by reddit.com IP addresses (mostly) independent of location 55https://www.digwebinterface.com","libVersion":"0.3.2","langs":""}