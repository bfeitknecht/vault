{"path":"sem4/CN/VRL/extra/slides/CN-s03-DNS.pdf","text":"Computer Networks: DNS Huayi Duan Slides adapted from Ankit Singla, Jennifer Rexford, Scott Shenker, Laurent Vanbever Photo: ETH Zürich / Gian Marco Castelberg Where we are in the course … Part 1: Overview & Principles Part 2: Applications Part 3: Transport Part 4: Algorithms 2 Computer Networks DNS: How do we name and discover services? The Web: How do you see weather.com? Video: How does video streaming work? #1 #2 #3 Part 2: Applications 3 Computer Networks DNS: How do we name and discover services? The Web: How do you see weather.com? Video: How does video streaming work? #1 #2 #3 Part 2: Applications 4 What purpose does “Domain Name Service” serve? The Internet has one global system for • addressing hosts • naming hosts IP Domain names by design by accident, an afterthought DNS 5 A nice, funny primer on the DNS [https://howdns.works] 6 The application invokes transport protocol to establish an app-to-app connection step 4 A person has name of entity she wants to access step 1 www.ethz.ch She invokes an application to perform the task step 2 Chrome The application invokes DNS to resolve the name into an IP address step 3 129.132.19.216 Using Internet services can be divided into four logical steps 7 129.132.19.216 IP addressname www.ethz.ch DNS The DNS system is a distributed database which enables resolving a name to an IP address 8 129.132.19.216 IP addressname www.ethz.ch DNS www.cloudflare.com 198.41.214.162 198.41.215.162 (load-balancing) In practice, names can be mapped to more than one IP 9 129.132.19.216 IP addressname www.ethz.ch DNS www.example.com www.example.net 93.184.216.34 93.184.216.34 (reuse your machine) “dig X” for X = {stackoverflow.com, superuser.com, serverfault.com} In practice, IPs can be mapped by more than one name 10 How does one resolve a name into a network address? 11 How does one resolve a name into a network address? The first one is from 1974. After a lot of fruitless searching, I remembered that back then we simply xeroxed the hosts.txt file and put it into the Arpanet Directory, so I copied that. The second copy is from 1982, shortly before we cut over to the domain naming system. It is quite long, so we split it into three parts which I am sending as three emails so as not to gronk anyone's mail system. Source: http://www.postel.org/pipermail/internet-history/2008-January.txt 12 How does one resolve a name into a network address? initially all name to address mappings were in a file called hosts.txt in /etc/hosts problem scalability in terms of query load & speed management consistency availability updated by download from authoritative list 13 When you need… you add… a layer of indirection more flexibility, When you need… you add… a hierarchical structure more scalability, gethostbyname() How does one resolve a name into a network address? 14 naming structure management infrastructure addresses are hierarchical https://www.inf.ethz.ch/de/departement/ hierarchy of authority over names hierarchy of DNS servers To scale, DNS uses three intertwined hierarchies 15 naming structure addresses are hierarchical https://www.inf.ethz.ch/de/departement/ To scale, DNS uses three intertwined hierarchies www . inf . ethz . ch . Read right to left, from here Mind the dot 18 Top Level Domain (TLDs) sit at the top Many new ones being added — see https://www.iana.org/domains/root/db root com org net edu gov mil chin de fr + many more “.” 19 Domains (2LDs) are subtrees root com org net edu gov mil chin de fr “.” ethz + many moreepfl nzz 20 root com org net edu gov mil chin de fr “.” ethz www inf ee + many more epfl nzz A name represents a leaf-to-root path in the hierarchy 21 management hierarchy of authority over names To scale, DNS uses three intertwined hierarchies 22 root com org net edu gov mil chin de fr ethz www inf ee epfl nzz The DNS system is hierarchically administered 23 managed by IANA (*) The DNS system is hierarchically administered (*) see http://www.iana.org/domains/root/db com org net edu gov mil chin de fr ethz www inf ee epfl nzz root 24 managed by The Swiss Education & Research Network (*) The DNS system is hierarchically administered (*) see https://www.switch.ch/about/id/ com org net edu gov mil in de fr ethz www inf ee epfl nzz root ch 25 com org net edu gov mil in de fr www inf ee nzz root ch The DNS system is hierarchically administered 26 ethzmanaged by ETH Zürich Informatikdienste ICT-Networks Hierarchical administration means that name collision is trivially avoided 27 Caveat: collision may occur due to private namespaces see https://www.icann.org/resources/pages/name-collision-2013-12-06-en infrastructure hierarchy of DNS servers To scale, DNS uses three intertwined hierarchies 28 The DNS infrastructure is hierarchically organized root com org net edu gov mil chin de fr ethz www inf ee epfl nzz 29 13 root servers (managed professionally) serve as root (*) (*) see http://www.root-servers.org/ com org net edu gov mil chin de fr ethz www inf ee epfl nzz root 30 root-servers.net root-servers.net root-servers.net root-servers.net root-servers.net root-servers.net root-servers.net root-servers.net root-servers.net root-servers.net root-servers.net root-servers.net root-servers.net a. b. c. d. e. f. g. h. i. j. k. l. m. VeriSign, Inc. University of Southern California Cogent Communications University of Maryland NASA Internet Systems Consortium US Department of Defense US Army Netnod VeriSign, Inc. RIPE NCC ICANN WIDE Project 13 root servers (managed professionally) serve as root (*) 31 Instances of the k-root server (*) are hosted in more than 75 locations worldwide (*) see k.root-servers.org 32 Swiss Internet Exchange ns1.ch-zrh.k.ripe.net CERN ns1.ch-gva.k.ripe.net Two of these locations are in Switzerland: in Zürich and in Geneva 33 Routing finds shortest-pathsIntuition This enables seamless replication of resources If several locations announce the same IP prefix, then routing will deliver the packets to the “closest” location To scale root servers, operators rely on BGP anycast 35 160k queries per second across k-roots 39 Do you see any problems in performing load-balancing this way? TLDs server are also managed professionally by private or non- profit organizations root ethz www inf ee epfl nzz com org net edu gov mil chin de fr 41 The bottom (and bulk) of the hierarchy is managed by Internet Service Providers or locally root ethz www inf ee epfl nzz com org net edu gov mil chin de fr 42 MX domain CNAME alias NS domain A hostname Records Name Value IP address DNS server name Mail server name canonical name PTR IP address corresponding hostname A DNS server stores Resource Records mapping names to values 43 $ dig ch. @a.root-servers.net. ch. 172800 IN NS a.nic.ch. ch. 172800 IN NS b.nic.ch. ch. 172800 IN NS c.nic.ch. … Each root server knows where to find all TLD servers root com org net edu gov mil chin de fr 44 Any .ch TLD server knows where to find all .ch domains root www inf ee epfl nzz com org net edu gov mil in de fr 45 $ dig ethz.ch. @a.nic.ch. ethz.ch. 3600 IN NS ns1.ethz.ch. ethz.ch. 3600 IN NS ns2.ethz.ch. ethz.ch. 3600 IN NS ns2.switch.ch. … ethz ch Each 2LD server knows about its subdomains, and so on root www inf ee epfl nzz com org net edu gov mil in de fr 46 $ dig inf.ethz.ch. @ns1.ethz.ch. inf.ethz.ch. 300 IN A 129.132.19.216 ethz ch OK, but where to find root servers? 47 (*) see https://www.internic.net/domain/named.root Use a root-hint file* Hard-coded in DNS software What if the nameserver of google.com is ns1.eg-123.net? And the nameserver of eg-123.net is ns1.eg-456.org? And the nameserver of eg-456.org is ns1.google.com? OK, how does this work? Glue records Break circular dependency $ dig +trace google.com google.com. 172800 IN NS ns2.google.com. google.com. 172800 IN NS ns1.google.com. Now, how do I get the IP address for ns2.google.com. ?? Shouldn’t that come from asking google.com ?? ;; AUTHORITY SECTION: google.com. 172800 IN NS ns2.google.com. google.com. 172800 IN NS ns1.google.com. ;; ADDITIONAL SECTION: ns2.google.com. 172800 IN A 216.239.34.10 ns1.google.com. 172800 IN A 216.239.32.10 48 Another form of circular dependency … DNS is complex! When I began to doubt if I understand DNS … 50 $ dig ethz.ch. @a.nic.ch. ;; AUTHORITY SECTION: ethz.ch. 3600 IN NS ns1.ethz.ch. ethz.ch. 3600 IN NS ns2.switch.ch. ethz.ch. 3600 IN NS ns2.ethz.ch. ;; ADDITIONAL SECTION: ns2.switch.ch. 3600 IN AAAA 2001:620:0:ff::2f ns2.ethz.ch. 3600 IN AAAA 2001:67c:10ec::b ns1.ethz.ch. 3600 IN AAAA 2001:67c:10ec::a ns2.switch.ch. 3600 IN A 130.59.31.29 ns2.ethz.ch. 3600 IN A 129.132.250.8 ns1.ethz.ch. 3600 IN A 129.132.98.8 $ dig google.com @a.nic.ch. ??? My hotel’s spoofing DNS responses … 51 naming structure management infrastructure addresses are hierarchical https://www.inf.ethz.ch/de/departement/ hierarchy of authority over names hierarchy of DNS servers To scale, DNS uses three intertwined hierarchies 52 DNS queries can be load-balanced across the replicas Ensure name service availability as long as one of the servers is up On timeout, clients use alternative servers exponential backoff when trying the same server To ensure availability, each domain must have at least a primary and secondary DNS server 53 Using DNS relies on two components resolver software (stub resolver) local DNS server usually, near the endhoststrigger resolution process configured statically (resolv.conf) dynamically (DHCP)or send request to local DNS server gethostbyname() 54 DNS queries and replies use UDP (port 53), reliability is implemented by repeating requests. 55 DNS resolution can either be recursive or iterative 56 root servers .edu servers nyu.edu servers DNS client (me.inf.ethz.ch) DNS server local (dns1.ethz.ch) 57 When performing a recursive query, the client offloads the task of resolving to the server root DNS server .edu servers nyu.edu servers DNS client (me.inf.ethz.ch) DNS server local (dns1.ethz.ch) 58 When performing a recursive query, the client offloads the task of resolving to the server .edu servers nyu.edu servers DNS client (me.inf.ethz.ch) DNS server local (dns1.ethz.ch) root DNS server 59 When performing a recursive query, the client offloads the task of resolving to the server nyu.edu servers DNS client (me.inf.ethz.ch) DNS server local (dns1.ethz.ch) root DNS server .edu servers 60 When performing a recursive query, the client offloads the task of resolving to the server Any performance issues? DNS client (me.inf.ethz.ch) DNS server local root DNS server nyu.edu servers .edu servers 61 When performing an iterative query, the server only returns the address of the next server to query Where is .edu? Where is www.nyu.edu? Where is nyu.edu? DNS server local DNS client (me.inf.ethz.ch) root DNS server nyu.edu servers .edu servers 62 When performing an iterative query, the server only returns the address of the next server to query The initial query is still recursive Authoritative servers associate a lifetime to each record Time-To-Live (TTL) DNS servers cache responses to former queries and your client and the applications (!) DNS records can only be cached for TTL seconds after which they must be cleared To reduce resolution times, DNS relies on caching 63 9% of lookups are unique Top 10% of names account for 70% of lookups Limit cache hit rate to 91% Practical cache hit rates ~75% As top-level servers rarely change & popular websites are visited often, caching is very effective (*) (*) see https://pdos.csail.mit.edu/papers/dns:ton.pdf 64 scalable available extensible #names, #updates, #lookups, #users, but also in terms of administration domains replicate independently of each other any level (including the TLDs) can be modified independently Overall, the DNS system is highly scalable, available, and extensible 65 Provide X with the name and IP of your DNS servers e.g., [ns1.next-startup.ch,129.132.19.253] You register next-startup.ch at a registrar X e.g. Swisscom or GoDaddy You set-up a DNS server @129.132.19.253 define A records for www, MX records for next-startup.ch… You’ve founded next-startup.ch and want to host it yourself, how do you insert it into the DNS? 66 DNS in a shifting landscape A significant outage of DNS could make the Internet unusable [DownDetector (CC BY-SA 4.0), via Wikimedia] 68 A significant outage of DNS could make the Internet unusable DDoS attacks on Dyn, Oct 2016 Home routers, cameras, baby monitors … 100,000 malicious hosts estimated to be involved (Unverified) 1.2 Tbps reported traffic volume 69 A significant outage of DNS could make the Internet unusable Facebook outage, Oct 2021 (due to network misconfiguration) Affecting Facebook, Messenger, Instagram, WhatsApp, ... 5+ hours downtime >30x increase in DNS query traffic 70 [Understanding how Facebook disappeared from the Internet] My hotel’s spoofing DNS responses … 71 DNS interception can happen everywhere 72 Once DNS data is corrupted, many other systems are in danger 73 [Dei et al., From IP to Transport and Beyond: Cross-Layer Attacks Against Applications, in SIGCOMM’21] DNS is often used for monitoring / tracking mail.google.com viewdns.info icann.org ndal.ethz.ch video.ethz.ch lehrbetrieb.ethz.ch fastly.com blog.apnic.net overleaf.com portal.azure.com … console.aws.amazon.com drkp.net eurosys2020.org people.epfl.ch people.csail.mit.edu cs.cornell.edu bdebopam.github.io satnetwork.github.io sigcomm2020.hotcrp.com arstechnica.com … Works on networking research Works at ETH, probably instructional role. Lives in Zürich Contact with B. Debopam, Dan Ports, people at EPFL, MIT, Cornell, … 74 In some countries, your ISP can sell your data Advertiser [Server image: RRZEicons via Wikimedia] 75 Does DNS-over-HTTPS solve this problem? [Server image: RRZEicons via Wikimedia] CloudFlare 1.1.1.1 mail.google.com viewdns.info icann.org ndal.ethz.ch video.ethz.ch lehrbetrieb.ethz.ch fastly.com blog.apnic.net overleaf.com portal.azure.com … Problem 1: Now you trust CloudFlare instead Problem 2: Encrypted traffic analysis is possible https://hacks.mozilla.org/2018/05/a-cartoon-intro-to-dns-over-https/ (*) see http://www.iana.org/domains/root/db 76 DNS is often used for blocking / censoring More details at https://arstechnica.com/?p=1546157 77 DNS is often behind security breaches 78 DNS is often behind security breaches Company starts a new “campaign” … contest.company.com1 79 DNS is often behind security breaches contest.company.com points to server-xyz.amazonaws.com using CNAME2 [Server image: RRZEicons via Wikimedia] server-xyz.amazonaws.comcontest.company.com CNAME (*) see http://www.iana.org/domains/root/db 80 DNS is often behind security breaches contest.company.com server-xyz.amazonaws.com [Server image: RRZEicons via Wikimedia] Company isn’t using server-xyz any more, but CNAME record persists3 (*) see http://www.iana.org/domains/root/db 81 DNS is often behind security breaches contest.company.com server-xyz.amazonaws.com [Server image: RRZEicons via Wikimedia] Attacker requests server-xyz from AWS, points to malicious site4 (*) see http://www.iana.org/domains/root/db 82 DNS haiku 84 Readings for this lecture Kurose-Ross (KR) sections 1.4 Delay, loss, and throughput in packet switched networks 1.7 (optional) History of computer networking and the Internet 2.4 DNS — The Internet’s directory service 85","libVersion":"0.3.2","langs":""}