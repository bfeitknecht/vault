{"path":"sem4/CN/VRL/extra/slides/CN-s22-routing-security.pdf","text":"Computer Networks: Routing Security Adrian Perrig Slide contributions by Laurent Vanbever, Jennifer Rexford, Scott Shenker Photo: ETH Zürich / Gian Marco Castelberg Lecture Outline • Basic security properties • Basic cryptographic mechanisms • Security for intra- and inter-domain routing protocols 2 Basic cryptography 34 • Often considered synonymous, but are slightly different • Secrecy - Keep data hidden from unintended receivers - “Alice and Bob use encrypted communication links to achieve secrecy” • Confidentiality - Keep someone else’s data secret - “Trent encrypts all user information to keep their client’s information confidential in case of a file server compromise” • Privacy - Keep data about a person secret - “To protect Alice’s privacy, company XYZ did not disclose any personal information” Secrecy, Confidentiality, Privacy, Anonymity 5 Secrecy Confidentiality Privacy Anonymity Secrecy, Confidentiality, Privacy, Anonymity • Anonymity - Keep identity of a protocol participant secret - “To hide her identity to the web server, Alice uses The Onion Router (TOR) to communicate” 6 Integrity, Authentication Sometimes used interchangeably, but they have different connotations Data integrity • Ensure data is “correct” (i.e., correct syntax & unchanged) • Prevents unauthorized or improper changes • “Trent always verifies the integrity of his database after restoring a backup, to ensure that no incorrect records exist” Entity authentic- cation or identification • Verify the identity of another protocol participant • “Alice authenticates Bob each time they establish a secure connection” Data authentication • Ensure that data originates from claimed sender • “For every message Bob sends, Alice authenticates it to ensure that it originates from Bob” 7 Basic Cryptographic Primitives • Asymmetric (public-private key) - Diffie-Hellman key agreement - Public-key encryption - Digital signature • Symmetric (shared-key) - Block cipher (pseudo-random permutation PRP) - Stream cipher (pseudo-random generators PRG) - Message authentication code (MAC) • Others (unkeyed symmetric) - One-way function - Cryptographic hash function • Encryption key = decryption key • Encryption: EK(plaintext) = ciphertext • Decryption: DK(ciphertext) = plaintext • We write {plaintext}K for EK(plaintext) 8 Encrypt DecryptPlaintext Ciphertext Plaintext Key Key Symmetric Encryption Primitives • Encryption key K is publicly known: public key • Decryption key K-1 is secret: private key • Encryption: EK(plaintext) = ciphertext • Decryption: DK-1(ciphertext) = plaintext • We write {plaintext}K for EK(plaintext) 9 Encrypt DecryptPlaintext Ciphertext Plaintext K K-1 Asymmetric Encryption Primitives • Verification key K is publicly known: public key • Generation key K-1 is secret: private key • Signature verification: SK(msg, sig) = true / false • Signature generation: SK-1(msg) = sig 10 Sign Verifymsg sig true / false KK-1 msg, sig Asymmetric Signature PrimitivesComparison Sym vs Asym Crypto • Need shared secret key • 128 bit key for high security (year 2020) • ~100,000,000 ops/s on 5GHz processor • Need authentic public key • 3072 bit key (RSA), 384 bit key (EC) for high security (year 2020) • ~1000 signatures/s ~10000 verify/s (RSA) on 5GHz processor Asymmetric cryptoSymmetric crypto 11 Useful resources • https://www.keylength.com • https://en.wikipedia.org/wiki/Key_size Selecting Cryptographic Key Lengths 12 Routing security attacks & mitigation 13 intra-domain routing inter-domain routing insider in/outsider Attacks on intra-domain routing 14 Why? Because link-state protocols rely on flooding To perform an attack on link-state protocols, one only needs to compromise one router … 15 compromised routerA B C D OSPF network compromised OSPF adjacency attacker acts as a Man-in-the-Middle (MITM) To perform an attack on link-state protocols, … or compromise one routing adjacency 16 A B C D OSPF network In both cases, the attacker obtains a complete network view & the ability to inject messages network-wide 17 compromised routerA B C D OSPF network A B C D OSPF network compromised adjacency Once you’re owning the link-state protocol, what can you do? Unfortunately… plenty! Interception DoS induce churn to overload the routers announce/withdraw at fast pace flood routers’ link-state database inject thousands of prefixes induce congestion/higher delay steer traffic along fewer/low-throughput paths prevent reachability steer traffic along blackholes or loops eavesdrop on/drop/modify/inject/delay traffic steer traffic along paths controlled by the attacker Most of the attacks on intra-domain routing aim at performing Denial-of-Service (DoS) or intercept traffic 19 Most of the attacks on intra-domain routing aim at performing Denial-of-Service (DoS) or intercept traffic Interception DoS induce churn to overload the routers announce/withdraw at fast pace floods the routers link-state database inject thousands of prefixes induce congestion/higher delay steer traffic along fewer/low-throughput paths prevent reachability steer traffic along blackholes or loops eavesdrop on/drop/modify/inject/delay traffic steer traffic along paths controlled by the attacker 20 Consider a source connected to C that sends traffic to 2 destinations connected to D 21 3 10 1 1 source A B C D OSPF network initial desired The attacker wants to intercept traffic to the blue destination 22 3 10 1 1 source A B C D OSPF network 3 10 1 1 source A B C D OSPF network For that the attacker can “lie” to the routers 23 3 10 1 1 source A B C D OSPF network Fake OSPF advertisement A C 11 For that the attacker can “lie” to the routers by injecting fake nodes, links and destinations in OSPF 24 3 10 1 1 source A B C D OSPF network A C A C Lies are propagated network-wide by the OSPF protocol 25 3 10 1 1 source A B C D OSPF network Physical next-hop of the “lie” is A 1 1 After the injection, this is the topology seen by all routers, on which they compute Dijkstra 26 3 10 1 1 source A B C D OSPF network C prefers A to reach the blue destination directing the traffic through the attacker 27 1 1 3 10 1 1 source A B C D OSPF network By injecting fake information into OSPF, the attacker can precisely control the network-wide behavior Theorem It is always possible to find fake OSPF messages forcing the routers to compute any forwarding tree Observation This gives us a way to program the network-wide behavior from a single location “à la SDN”, in existing networks 28 Most of the attacks on intra-domain routing aim at performing Denial-of-Service (DoS) or intercept traffic Interception DoS induce churn to overload the routers announce/withdraw at fast pace floods the routers link-state database inject thousands of prefixes induce congestion/higher delay steer traffic along fewer/low-throughput paths prevent reachability steer traffic along blackholes or loops eavesdrop on/drop/modify/inject/delay traffic steer traffic along paths controlled by the attacker 29 1 Gbps By steering traffic, attackers can create congestion and increase delay traffic flows along a low throughput path 30 C 1 1 1 3 10 1 1 source A B C D 10 Gbps 1 1 By steering traffic, attackers can create loops and induce blackholes traffic is trapped in a forwarding loop between A and C 31 3 10 1 1 source A B C D OSPF network Bogus advertisements can be injected Legitimate advertisements can be altered Use Cryptographic Authentication (header) Send authenticated announcements and cryptographically protect topology information Problem Solution The solution is quite simple: Rely on cryptography! 32 Routing security attacks & mitigation 33 intra-domain routing inter-domain routing insider in/outsider Attacks on inter-domain routing 34 Routing attacks can be used to de-anonymize Tor users See http://vanbever.eu/pdfs/vanbever_raptor_usenix_security_2015.pdf 35 See https://btc-hijack.ethz.ch Routing attacks can be used to partition the Bitcoin network 36 5 Routing attacks can be used to obtain bogus certificates 37 See: https://secure-certificates.princeton.edu Routing attacks can be used to eavesdrop on encrypted VPN connections or VoIP calls 38 BGP does not validate the origin of advertisements BGP does not validate the content of advertisements Proposed Enhancements What about the data plane? What’s the Internet to do anyway? #1 #2 #3 #4 #5 BGP (lack of) security: problems & solutions 39 The trouble with BGP 40 BGP does not validate the origin of advertisements BGP does not validate the content of advertisements Proposed Enhancements What about the data plane? What’s the Internet to do anyway? #1 #2 #3 #4 #5 BGP (lack of) security: problems & solutions 41 IP Address Ownership and Hijacking • Regional Internet Registries (ARIN, RIPE, APNIC) • Internet Service Providers IP address block assignment • By the AS who owns the prefix • … or, by its upstream provider(s) on its behalf Proper origination of a prefix into BGP • Prefix hijacking: another AS originates the prefix • BGP does not verify that the AS is authorized • Registries of prefix ownership are inaccurate However, what’s to stop someone else? 42 12.34.0.0/16 Prefix Hijacking 1 2 3 4 5 67 43 12.34.0.0/16 Prefix Hijacking 1 2 3 4 5 67 44 12.34.0.0/1612.34.0.0/16 Prefix Hijacking 1 2 3 4 5 67 45 12.34.0.0/1612.34.0.0/16 Prefix Hijacking 1 2 3 4 5 67 • Blackhole: data traffic is discarded • Snooping: data traffic is inspected, then redirected 46 Hijacking is Hard to Debug • Picks its own route, might not learn the bogus route The victim AS doesn’t see the problem • Snooping causes performance degradation May not cause loss of connectivity • E.g., only for sources in parts of the Internet Or, partial loss of connectivity • Analyzing updates from many vantage points • Launching traceroute from many vantage points Diagnosing prefix hijacking 47 12.34.0.0/161 2 3 4 5 67 Sub-Prefix Hijacking 48 12.34.0.0/16 12.34.158.0/24 1 2 3 4 5 67 Sub-Prefix Hijacking 49 12.34.0.0/16 12.34.158.0/24 1 2 3 4 5 67 Originating a more-specific prefix • Every AS picks the bogus route for that prefix • Traffic follows the longest matching prefix Sub-Prefix Hijacking 50 • Router with BGP session(s) • Configured to originate the prefix The hijacking AS has • Network operator makes configuration mistake • Disgruntled operator launches an attack • Outsider breaks into the router and reconfigures it Getting access to the router • Neighbor ASes do not discard the bogus route • E.g., not applying protective filtering Getting other ASes to believe bogus route How to Hijack a Prefix 51 YouTube Outage on Feb 24, 2008 • Web site www.youtube.com (208.65.152.0/22) YouTube (AS 36561) • Government order to block access to YouTube • Announces 208.65.153.0/24 to PCCW (AS 3491) • All packets to YouTube get dropped on the floor Pakistan Telecom (AS 17557) • AS 17557: announce to everyone, not just customers • AS 3491: not filtering routes announced by AS 17557 Mistakes were made Lasted around 2 hours 52 Timeline (UTC Time) First evidence of hijacked /24 route in Asia 18:47:45 Several big trans-Pacific providers carrying the route 18:48:00 Bogus route fully propagated 18:49:30 YouTube starts advertising /24 to attract traffic back 20:07:25 Many (but not all) providers are using valid route 20:08:30 53 Timeline (UTC Time) YouTube announces two more-specific /25 routes 20:18:43 Some more providers start using the /25 routes 20:19:37 AS 17557 starts prepending (“3491 17557 17557”) 20:50:59 AS 3491 disconnects AS 17557 20:59:39 Videos of cats flushing toilets are available again! 21:00:00 54 • Establish TCP connection to mail server • Sending spam e- mail, then disconnect Spammers sending spam email • Relatively easy to trace back to you But, best not to use your real IP address • But you might not receive all the (TCP) return traffic Approach: hijack someone’s address space • Hijack unused (i.e., unallocated) address block • Temporarily use the IP addresses to send your spam How to evade detection Another Example: Spammers 55 BGP does not validate the origin of advertisements BGP does not validate the content of advertisements Proposed Enhancements What about the data plane? What’s the Internet to do anyway? #1 #2 #3 #4 #5 BGP (lack of) security: problems & solutions 56 Bogus AS Paths 701 883715 ? • Remove ASes from the AS path - E.g., turn “701 3715 88” into “701 88” • Motivations - Attract sources that normally try to avoid AS 3715 - Help AS 88 look like it is closer to the Internet’s core • Who can tell that this AS path is a lie? - Maybe AS 88 does connect to AS 701 directly 57 701 88 Bogus AS Paths • Add ASes to the path - E.g., turn “701 88” into “701 3715 88” • Motivations - Trigger loop detection in AS 3715 - Denial-of-service attack on AS 3715 - Or, blocking unwanted traffic coming from AS 3715! - Make your AS look like it has richer connectivity • Who can tell the AS path is a lie? - AS 3715 could, if it could see the route - AS 88 could, but it may not care 58 701 88 3 18.0.0.0/8 18.0.0.0/8 Bogus AS Paths • Adds AS hop(s) at the end of the path - E.g., turns “701 88” into “701 88 3” • Motivations - Evade detection for a bogus route - E.g., by adding the legitimate AS to the end • Hard to tell that the AS path is bogus… - Even if other ASes filter based on prefix ownership 59 BGP data Invalid Paths: Route Leak • Route leak: AS exports a route it shouldn’t - AS path is a valid sequence, but violated policy • Example: customer misconfiguration - Exports routes from one provider to another • Interacts with provider policy - Provider prefers customer routes - Directing all traffic through customer • Main defense - Filtering routes based on prefixes and AS path 60 src dest Bad AS data BGP Missing/Inconsistent Routes • Peers require consistent export - Prefix advertised at all peering points - Prefix advertised with same AS path length • Reasons for violating the policy - Trick neighbor into “cold potato” - Configuration mistake • Main defense - Analyzing BGP updates, or traffic for signs of inconsistency 61 BGP Security Today • Applying best common practices (BCPs) - Securing the BGP peering session between routers (authentication, secrecy) - Filtering routes by prefix and AS path - Packet filters to block unexpected control traffic • This is not good enough - Depends on vigilant application of BCPs - Doesn’t address fundamental problems - Can’t tell who owns the IP address block - Can’t tell if the AS path is bogus or invalid - Can’t be sure the data packets follow the chosen route • Bright spot: RPKI + ROA - Resource Public-Key Infrastructure (RPKI) provides per-prefix certificates - Enables signature of first-hop AS, which is called a Route Origin Authorization (ROA) - Increasing use by ISPs 62 BGP (lack of) security: problems & solutions BGP does not validate the origin of advertisements BGP does not validate the content of advertisements Proposed Enhancements What about the data plane? What’s the Internet to do anyway? #1 #2 #3 #4 #5 63 Public Key Signature: Anyone who knows v’s public key can verify that the message was sent by v. a1 a2 v a3 m v announces: (v, Prefix) v announces: (v, Prefix) a1 announces: (a1, v, Prefix) Origin Authentication + cryptographic signatures IP Prefix Secure BGP 64 BGPSEC Secure Version of BGP • Address attestations - Claim the right to originate a prefix - Signed and distributed out-of-band - Checked through delegation chain from ICANN • Route attestations - Distributed as an attribute in BGP update message - Signed by each AS as route traverses the network • Resource Public-Key Infrastructure (RPKI) - Per-prefix certificate issued by Regional Internet Registries (RIR) - Used to authenticate first AS hop through Route Origin Authorization (ROA) to implement address attestation • BGPsec can validate - AS path indicates the order ASes were traversed - No intermediate ASes were added or removed 65 BGPSEC Deployment Challenges • Complete, accurate registries of prefix “owner” • Public Key Infrastructure - To know the public key for any given AS • Cryptographic operations - E.g., digital signatures on BGP messages • Need to perform operations quickly - To avoid delaying response to routing changes • Difficulty of incremental deployment - Hard to have a “flag day” to deploy BGPSEC 66 Incrementally Deployable Solutions? • Backward compatible - No changes to router hardware or software - No cooperation from other ASes • Incentives for early adopters - Security benefits for ASes that deploy the solution - … and further incentives for others to deploy • What kind of solutions are possible? - Detecting suspicious routes - … and then filtering or depreferencing them 67 Detecting Suspicious Routes • Monitoring BGP update messages - Use past history as an implicit registry • E.g., AS that announces each address block - Prefix 18.0.0.0/8 usually originated by AS 3 • E.g., AS-level edges and paths - Never seen the subpath “7018 88 1785” • Out-of-band detection mechanism - Generate reports and alerts - Internet Alert Registry: http://iar.cs.unm.edu/ - Prefix Hijack Alert System: http://phas.netsec.colostate.edu/ - ARTEMIS https://github.com/FORTH-ICS-INSPIRE/artemis 68 Avoiding Suspicious Routes • Soft response to suspicious routes - Prefer routes that agree with the past - Delay adoption of unfamiliar routes when possible • Why is this good enough? - Some attacks will go away on their own - Give network operators time to investigate • How well would it work? - If top ~40 largest ASes applied the technique - … most other ASes are protected, too 69 BGP does not validate the origin of advertisements BGP does not validate the content of advertisements Proposed Enhancements What about the data plane? What’s the Internet to do anyway? #1 #2 #3 #4 #5 BGP (lack of) security: problems & solutions 70 Control Plane vs. Data Plane • Control plane - BGP security concerns validity of routing messages - I.e., did the BGP message follow the sequence of ASes listed in the AS-path attribute? • Data plane - Routers forward data packets - Supposedly along path chosen in the control plane - But what ensures that this is true? 71 Data-Plane Attacks • Adversary must control a router along the path or hijack prefix - So that the traffic flows through it • How to gain control of a router - Buy access to a compromised router online - Guess the password, exploit router vulnerabilities - Insider attack (disgruntled network operator) 72 Specific Data-Plane Attacks (1) • Drop packets in the data plane - While still sending the routing announcements • Easier to evade detection - Especially if you only drop some packets - Such as only BitTorrent or Skype traffic • Even easier if you just slow down some traffic - How different are normal congestion and an attack? - Especially if you let traceroute packets through quickly? 73 Specific Data-Plane Attacks (2) • Send packets in a different direction - Disagreeing with the routing announcements • Direct packets to a different destination - E.g., one the adversary controls • What to do at that bogus destination? - Snoop on traffic and forward along to real destination - Impersonate the legitimate destination • How to detect? - Traceroute? Longer than usual delays? - End-to-end checks, e.g., using site certificate? 74 BGP does not validate the origin of advertisements BGP does not validate the content of advertisements Proposed Enhancements What about the data plane? What’s the Internet to do anyway? #1 #2 #3 #4 #5 BGP (lack of) security: problems & solutions 75 Several high-profile outages • http://merit.edu/mail.archives/nanog/1997-04/msg00380.html • http://www.renesys.com/blog/2005/12/internetwide_nearcatastrophela.shtml • http://www.renesys.com/blog/2006/01/coned_steals_the_net.shtml • http://www.renesys.com/blog/2008/02/pakistan_hijacks_youtube_1.shtml • http://www.theregister.co.uk/2010/04/09/china_bgp_interweb_snafu/ • https://bgpmon.net/bgp-leak-causing-internet-outages-in-japan-and-beyond/ Many smaller examples • Blackholing a single destination prefix • Hijacking unallocated addresses to send spam Why isn’t it an even bigger deal? • Really, most big outages are configuration errors • Most bad guys want the Internet to stay up BGP is Highly Vulnerable 76 Prefix Hijacking Examples Attacker performs prefix hijacking in a way that it can still send traffic to the destination (how can this be done?) 77 Prefix Hijacking Examples Attacker performs prefix hijacking in a way that it can still send traffic to the destination (how can this be done?) 78 Prefix Hijacking Examples Attacker performs prefix hijacking in a way that it can still send traffic to the destination (how can this be done?) 79 Prefix Hijacking Examples Attacker performs prefix hijacking in a way that it can still send traffic to the destination (how can this be done?) 8081 BGP is Very Hard to Fix Complex system • Large, with around 80,000 ASes • Decentralized control among competing ASes Hard to reach agreement on the right solution • BGPSEC with PKI, registries, and crypto? • Who should be in charge of running PKI & registries? • Worry about data- plane attacks or just control plane? Hard to deploy the solution once you pick it • Hard enough to get ASes to apply route filters • Now you want them to upgrade to a new protocol BGPSEC introduces new problems • Kill switch for turning off Internet in parts of the world • Even slower convergence than BGP • Reduced scalability, higher overhead, as prefix aggregation not possible 82 Conclusions Internet protocols designed based on trust • Insiders are good guys, bad guys on the outside Border Gateway Protocol is very vulnerable • Glue that holds the Internet together • Hard for an AS to locally identify bogus routes • Attacks can have very serious global consequences Proposed solutions/approaches • Secure variants of the Border Gateway Protocol • RPKI + ROA protects first AS hop • Anomaly detection, with automated response • Broader focus on data- plane availability • Next-Generation Internet architectures to the rescue! 83","libVersion":"0.5.0","langs":""}